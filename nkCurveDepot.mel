/*! © 2023 imaoki | MIT License | https://github.com/imaoki */

// /////////////////////////////////////////////////////////////////////////////
// ボイラープレート
// /////////////////////////////////////////////////////////////////////////////
// アサーション
/*1.0.0*/proc string assertTrue(int $a) {return ($a == true) ? "" : ("Assert: expected 1, got " + $a);}proc string assertFalse(int $a) {return ($a == false) ? "" : ("Assert: expected 0, got " + $a);}proc string assertFloatEqual(float $e, float $a, float $t) {return (`abs ($e - $a)` <= $t) ? "" : ("Assert: expected " + $e + ", got " + $a);}proc string assertFloatNotEqual(float $e, float $a, float $t) {return (`abs ($e - $a)` > $t) ? "" : ("Assert: expected " + $e + ", got " + $a);}proc string assertIntEqual(int $e, int $a) {return ($a == $e) ? "" : ("Assert: expected " + $e + ", got " + $a);}proc string assertIntNotEqual(int $e, int $a) {return ($a != $e) ? "" : ("Assert: expected " + $e + ", got " + $a);}proc string assertStringEqual(string $e, string $a) {return ($a == $e) ? "" : ("Assert: expected " + $e + ", got " + $a);}proc string assertStringNotEqual(string $e, string $a) {return ($a != $e) ? "" : ("Assert: expected " + $e + ", got " + $a);}proc string assertFloatArrayEqual(float $es[], float $as[], float $t) {int $numAs = `size $as`;int $isEqual = $numAs == `size $es`;if ($isEqual) {for ($i = 0; $i < $numAs; $i++) {$isEqual = `abs ($es[$i] - $as[$i])` <= $t;if (!$isEqual) break;}}return ($isEqual) ? "" : ("Assert: expected {" + floatArrayToString($es, ", ") + "}, got {" + floatArrayToString($as, ", ") + "}");}proc string assertIntArrayEqual(int $es[], int $as[]) {int $numAs = `size $as`;int $isEqual = $numAs == `size $es`;if ($isEqual) {for ($i = 0; $i < $numAs; $i++) {$isEqual = $as[$i] == $es[$i];if (!$isEqual) break;}}return ($isEqual) ? "" : ("Assert: expected {" + intArrayToString($es, ", ") + "}, got {" + intArrayToString($as, ", ") + "}");}proc string assertStringArrayEqual(string $es[], string $as[]) {int $numAs = `size $as`;int $isEqual = $numAs == `size $es`;if ($isEqual) {for ($i = 0; $i < $numAs; $i++) {$isEqual = $as[$i] == $es[$i];if (!$isEqual) break;}}return ($isEqual) ? "" : ("Assert: expected {" + stringArrayToString($es, ", ") + "}, got {" + stringArrayToString($as, ", ") + "}");}
// アトリビュート
/*1.2.1*/proc string[] getConnections(string $n,int $dir,string $type,string $sourceAttributes[],string $targetAttributes[]) {string $nodes[];clear $sourceAttributes;clear $targetAttributes;if (!`objExists $n`) return $nodes;int $d = $dir == 1;int $s = $dir == 0;string $unpluggedConnections[] = `listConnections -c 1 -d $d -et 1 -p 0 -s $s -t $type $n`;int $numConnections = `size $unpluggedConnections`;if (!$numConnections) return $nodes;if (`fmod $numConnections 2` != 0) return $nodes;string $pluggedConnections[] = `listConnections -c 1 -d $d -et 1 -p 1 -s $s -t $type $n`;if (`size $pluggedConnections` != $numConnections) return $nodes;for ($i = 0; $i < $numConnections; $i += 2) {if ($dir) {$sourceAttributes[`size $sourceAttributes`] = $pluggedConnections[$i];$targetAttributes[`size $targetAttributes`] = $pluggedConnections[$i + 1];}else {$sourceAttributes[`size $sourceAttributes`] = $pluggedConnections[$i + 1];$targetAttributes[`size $targetAttributes`] = $pluggedConnections[$i];}$nodes[`size $nodes`] = $unpluggedConnections[$i + 1];}$nodes = stringArrayRemoveDuplicates($nodes);return $nodes;}proc connectAttributes(string $sourceAttributes[], string $targetAttributes[], int $force) {int $numAttributes = `size $sourceAttributes`;if (`size $targetAttributes` != $numAttributes) return;for ($i = 0; $i < $numAttributes; $i++) {string $sourceAttribute = $sourceAttributes[$i];string $targetAttribute = $targetAttributes[$i];if (`isConnected -iuc $sourceAttribute $targetAttribute`) continue;if ($force) {connectAttr -f $sourceAttribute $targetAttribute;}else {connectAttr $sourceAttribute $targetAttribute;}}}proc disconnectAttributes(string $sourceAttributes[], string $targetAttributes[]) {int $numAttributes = `size $sourceAttributes`;if (`size $targetAttributes` != $numAttributes) return;for ($i = 0; $i < $numAttributes; $i++) {string $sourceAttribute = $sourceAttributes[$i];string $targetAttribute = $targetAttributes[$i];if (!`isConnected -iuc $sourceAttribute $targetAttribute`) continue;disconnectAttr $sourceAttribute $targetAttribute;}}
// ファイル
/*1.5.2*/proc string escapeStringForPythonAtFile(string $input) {string $escapedText;int $size = `size $input`;for ($i = 1; $i <= $size; $i++) {string $c = `substring $input $i $i`;switch ($c) {case "\\": $escapedText += "\\\\"; break;case "'": $escapedText += "\\'"; break;case "\n": $escapedText += "\\n"; break;case "\r": $escapedText += "\\r"; break;default: $escapedText += $c; break;}}return $escapedText;}proc int isValidFilename(string $input) {return (`match "[:\?\"\*/\\<>\|\n\r\t]" $input` == "");}proc string escapeInvalidFileNameChars(string $input, string $replacement) {string $pattern = escapeStringForPythonAtFile("[:\?\"\*/\\<>\|\n\r\t]");$input = escapeStringForPythonAtFile($input);$replacement = escapeStringForPythonAtFile($replacement);python("import re");string $result = `python("re.sub(r'" + $pattern + "', '" + $replacement + "', '" + $input + "')")`;return $result;}proc string getSourceFilename(string $procName) {string $filename;string $thisIs = `whatIs $procName`;string $pattern1 = "^Mel procedure found in: *";string $pattern2 = "^Script found in: *";if (`match $pattern1 $thisIs` != "") {$filename = `substitute $pattern1 $thisIs ""`;}else if (`match $pattern2 $thisIs` != "") {$filename = `substitute $pattern2 $thisIs ""`;}return $filename;}proc string getSourceDirname(string $procName) {return dirname(getSourceFilename($procName));}proc int existsDirname(string $dirname) {return `filetest -d $dirname`;}proc int existsFilename(string $filename) {return `filetest -f $filename`;}proc string[] getDirnames(string $dirname) {string $subDirnames[];string $filenames[] = `getFileList -fld $dirname`;for ($i = 0; $i < `size $filenames`; $i++) {string $subDirname = $dirname + "/" + $filenames[$i];if (existsDirname($subDirname)) {$subDirnames[`size $subDirnames`] = $subDirname;}}$subDirnames = `sortCaseInsensitive $subDirnames`;return $subDirnames;}proc string[] getFilenames(string $dirname, string $filenamePattern) {string $filenames[] = `getFileList -fs $filenamePattern -fld $dirname`;for ($i = 0; $i < `size $filenames`; $i++) {$filenames[$i] = $dirname + "/" + $filenames[$i];}$filenames = `sortCaseInsensitive $filenames`;return $filenames;}proc string getOpenFilename(string $caption, string $fileFilter) {string $filename;string $filenames[] = `fileDialog2 -cap $caption -ds 2 -ff $fileFilter -fm 1`;if (`size $filenames`) $filename = $filenames[0];return $filename;}proc string getSaveFilename(string $caption, string $fileFilter) {string $filename;string $filenames[] = `fileDialog2 -cap $caption -ds 2 -ff $fileFilter -fm 0`;if (`size $filenames`) $filename = $filenames[0];return $filename;}proc string[] readAllLines(string $filename, string $encoding) {if (!`size $encoding`) $encoding = "utf-8";string $lines[];if (!existsFilename($filename)) return $lines;python("with open('" + $filename + "', 'r', encoding='" + $encoding + "') as f:" + " lines = tuple(s.rstrip('\\r\\n') for s in f.readlines())");$lines = `python("lines")`;return $lines;}proc string readAllText(string $filename, string $encoding) {if (!`size $encoding`) $encoding = "utf-8";string $text;if (!existsFilename($filename)) return $text;python("with open('" + $filename + "', 'r', encoding='" + $encoding + "') as f: text = f.read()");$text = `python("text")`;return $text;}proc int writeAllText(string $filename, string $encoding, string $input) {string $dirname = dirname($filename);if (!existsDirname($dirname)) return false;$input = escapeStringForPythonAtFile($input);if (!`size $encoding`) $encoding = "utf-8";python("with open('" + $filename + "', 'w', encoding='" + $encoding + "') as f:" + " num = f.write('" + $input + "')");return (existsFilename($filename));}proc int writeAllLines(string $filename, string $encoding, string $lines[]) {string $text = stringArrayToString($lines, "\n");if (`size $lines`) $text += "\n";return (writeAllText($filename, $encoding, $text));}proc int makeDirs(string $dirname) {if (existsDirname($dirname)) return true;if (existsFilename($dirname)) return false;python("import os");python("os.makedirs('" + $dirname + "')");return (existsDirname($dirname));}proc int moveDir(string $sourceDirname, string $destDirname) {if (!existsDirname($sourceDirname)) return false;if (existsDirname($destDirname) || existsFilename($destDirname)) return false;python("import os");python("os.rename('" + $sourceDirname + "', '" + $destDirname +"')");return (!existsDirname($sourceDirname) && existsDirname($destDirname));}proc int moveFile(string $sourceFilename, string $destFilename) {if (!existsFilename($sourceFilename)) return false;if (existsDirname($destFilename) || existsFilename($destFilename)) return false;python("import os");python("os.rename('" + $sourceFilename + "', '" + $destFilename +"')");return (!existsFilename($sourceFilename) && existsFilename($destFilename));}proc int deleteDir(string $dirname) {if (!existsDirname($dirname)) return false;python("import os");python("if len(os.listdir('" + $dirname + "')) == 0:" + " os.rmdir('" + $dirname + "')");return (!existsDirname($dirname));}proc int deleteFile(string $filename) {if (!existsFilename($filename)) return false;python("import os");python("os.remove('" + $filename + "')");return (!existsFilename($filename));}
// 数値
/*1.0.0*/proc int isInRangeFloat(float $value, float $min, float $max) {return ($min <= $value && $value <= $max);}proc int isInRangeInt(int $value, int $min, int $max) {return ($min <= $value && $value <= $max);}
// 文字列
/*1.0.1*/proc string escapeStringForPythonAtString(string $input) {string $escapedText;int $size = `size $input`;for ($i = 1; $i <= $size; $i++) {string $c = `substring $input $i $i`;switch ($c) {case "\\": $escapedText += "\\\\"; break;case "'": $escapedText += "\\'"; break;case "\n": $escapedText += "\\n"; break;case "\r": $escapedText += "\\r"; break;default: $escapedText += $c; break;}}return $escapedText;}proc string strip(string $input) {return `python("'" + escapeStringForPythonAtString($input) + "'.strip()")`;}proc string regexSearchGroup(string $pattern, string $input, string $flags) {$flags = (`size $flags`) ? "(?" + $flags + ")" : "";$pattern = "'" + $flags + escapeStringForPythonAtString($pattern) + "'";$input = "'" + escapeStringForPythonAtString($input) + "'";python("import re");string $result = `python("(lambda m: m.group() if m else None)(re.search(" + $pattern + ", " + $input + "))")`;return $result;}proc int[] regexSearchSpan(string $pattern, string $input, string $flags) {$flags = (`size $flags`) ? "(?" + $flags + ")" : "";$pattern = "'" + $flags + escapeStringForPythonAtString($pattern) + "'";$input = "'" + escapeStringForPythonAtString($input) + "'";python("import re");int $result[] = `python("(lambda m: m.span() if m else None)(re.search(" + $pattern + ", " + $input + "))")`;return $result;}proc string[] regexMatchGroups(string $pattern, string $input, string $flags) {$flags = (`size $flags`) ? "(?" + $flags + ")" : "";$pattern = "'" + $flags + escapeStringForPythonAtString($pattern) + "'";$input = "'" + escapeStringForPythonAtString($input) + "'";python("import re");string $result[] = `python("tuple([m.group() for m in re.finditer(" + $pattern + ", " + $input + ")])")`;return $result;}proc string[] regexMatchSubGroups(string $pattern, string $input, string $flags) {$flags = (`size $flags`) ? "(?" + $flags + ")" : "";$pattern = "'" + $flags + escapeStringForPythonAtString($pattern) + "'";$input = "'" + escapeStringForPythonAtString($input) + "'";python("import re");string $result[] = `python("sum([m.groups() for m in re.finditer(" + $pattern + ", " + $input + ")], ())")`;return $result;}proc int[] regexMatchSpans(string $pattern, string $input, string $flags) {$flags = (`size $flags`) ? "(?" + $flags + ")" : "";$pattern = "'" + $flags + escapeStringForPythonAtString($pattern) + "'";$input = "'" + escapeStringForPythonAtString($input) + "'";python("import re");int $result[] = `python("sum([m.span() for m in re.finditer(" + $pattern + ", " + $input + ")], ())")`;return $result;}proc string[] regexSplit(string $pattern, string $input, string $flags) {$flags = (`size $flags`) ? "(?" + $flags + ")" : "";$pattern = "'" + $flags + escapeStringForPythonAtString($pattern) + "'";$input = "'" + escapeStringForPythonAtString($input) + "'";python("import re");string $result[] = `python("tuple(re.split(" + $pattern + ", " + $input + "))")`;return $result;}proc string regexReplace(string $pattern,string $replacement,string $input,string $flags) {$flags = (`size $flags`) ? "(?" + $flags + ")" : "";$pattern = "'" + $flags + escapeStringForPythonAtString($pattern) + "'";$replacement = "'" + escapeStringForPythonAtString($replacement) + "'";$input = "'" + escapeStringForPythonAtString($input) + "'";python("import re");string $result = `python("re.sub(" + $pattern + ", " + $replacement + ", " + $input + ")")`;return $result;}proc string getClipboardText() {python("from PySide2 import QtGui");python("cb = QtGui.QClipboard()");return python("cb.text()");}proc setClipboardText(string $text) {python("from PySide2 import QtGui");python("cb = QtGui.QClipboard()");python("cb.setText('" + escapeStringForPythonAtString($text) + "')");}
// UIコントロール
/*2.0.0*/global string $nkUIControls[];proc appendUIControls(string $controls[]) {global string $nkUIControls[];for ($control in $controls) {$nkUIControls[`size $nkUIControls`] = $control;}}proc string getUIControl(string $root, string $end) {global string $nkUIControls[];string $path;for ($control in $nkUIControls) {string $buffer[];int $depth = `tokenize $control "|" $buffer`;string $first = ($depth > 0) ? $buffer[0] : "";string $last = ($depth > 0) ? $buffer[$depth - 1] : "";if ($first == $root && $last == $end) {$path = $control;break;}}return $path;}proc removeUIControls(string $root, string $end) {global string $nkUIControls[];string $paths[];for ($control in $nkUIControls) {string $buffer[];int $depth = `tokenize $control "|" $buffer`;string $first = ($depth > 0) ? $buffer[0] : "";string $last = ($depth > 0) ? $buffer[$depth - 1] : "";int $shouldRemove = (!`size $end`) ? $first == $root : $first == $root && $last == $end;if ($shouldRemove) $paths[`size $paths`] = $control;}if (`size $paths` > 0) {$nkUIControls = stringArrayRemove($paths, $nkUIControls);}}proc string uiControlTypeOf(string $control) {string $type = `objectTypeUI $control`;if ($type == "floatingWindow") $type = "window";return $type;}proc int qEnable(string $control) {string $type = uiControlTypeOf($control);if ($type == "window" || $type == "workspaceControl") return true;return `control -q -en $control`;}proc eEnable(int $value, string $control) {string $type = uiControlTypeOf($control);if ($type == "window" || $type == "workspaceControl") return;control -e -en $value $control;}proc int qExists(string $control) {return `control -q -ex $control`;}proc int qVisible(string $control) {return `control -q -vis $control`;}proc eVisible(int $value, string $control) {control -e -vis $value $control;}proc float qFloat(string $type, string $flag, string $control) {return `eval $type "-q" $flag $control`;}proc eFloat(string $type, string $flag, float $value, string $control) {eval $type "-e" $flag $value $control;}proc int qInt(string $type, string $flag, string $control) {return `eval $type "-q" $flag $control`;}proc eInt(string $type, string $flag, int $value, string $control) {eval $type "-e" $flag $value $control;}proc string qString(string $type, string $flag, string $control) {return `eval $type "-q" $flag $control`;}proc eString(string $type, string $flag, string $value, string $control) {eval $type "-e" $flag ("\"" + $value + "\"") $control;}proc float[] qFloatArray(string $type, string $flag, string $control) {return `eval $type "-q" $flag $control`;}proc int[] qIntArray(string $type, string $flag, string $control) {return `eval $type "-q" $flag $control`;}proc string[] qStringArray(string $type, string $flag, string $control) {return `eval $type "-q" $flag $control`;}proc eStringArray(string $type, string $flag, string $values[], string $control) {for ($value in $values) {eString($type, $flag, $value, $control);}}proc eOrderedFloat(string $type, string $flag, float $values[], string $control) {for ($i = 0; $i < `size $values`; $i++) {eFloat($type, ($flag + ($i + 1)), $values[$i], $control);}}proc eOrderedInt(string $type, string $flag, int $values[], string $control) {for ($i = 0; $i < `size $values`; $i++) {eInt($type, ($flag + ($i + 1)), $values[$i], $control);}}proc eOrderedString(string $type, string $flag, string $values[], string $control) {for ($i = 0; $i < `size $values`; $i++) {eString($type, ($flag + ($i + 1)), $values[$i], $control);}}proc int qIndex(string $type, string $flag, string $control) {return (qInt($type, $flag, $control) - 1);}proc eIndex(string $type, string $flag, int $index, string $control) {eInt($type, $flag, ($index + 1), $control);}proc int[] qIndexArray(string $type, string $flag, string $control) {int $indices[] = qIntArray($type, $flag, $control);for ($i = 0; $i < `size $indices`; $i++) $indices[$i] -= 1;return $indices;}proc eIndexArray(string $type, string $flag, int $indices[], string $control) {for ($i in $indices) {eInt($type, $flag, $i + 1, $control);}}proc int qFirstIndex(string $type, string $flag, string $control) {int $indices[] = qIndexArray($type, $flag, $control);return  ((`size $indices`) ? $indices[0] : -1);}proc string qFirstString(string $type, string $flag, string $control) {string $values[] = qStringArray($type, $flag, $control);return  ((`size $values`) ? $values[0] : "");}proc eIntString(string $type, string $flag, int $index, string $value, string $control) {eval $type "-e" $flag $index ("\"" + $value + "\"") $control;}proc eIndexString(string $type, string $flag, int $index, string $value, string $control) {eIntString($type, $flag, $index + 1, $value, $control);}proc executeUIControl(string $type, string $flag, string $control) {eval $type "-e" $flag $control;}proc string getParentableWindow(string $control) {if (uiControlTypeOf($control) == "workspaceControl" && !qInt("workspaceControl", "-fl", $control)) {return "MayaWindow";}else {return $control;}}proc windowClose(string $control) {if (qExists($control)) {string $type = uiControlTypeOf($control);switch ($type) {case "window": deleteUI $control; break;case "workspaceControl": executeUIControl("workspaceControl", "-cl", $control);break;default: break;}}}proc windowPrefRemove(string $type, string $control) {if (qExists($control)) windowClose($control);switch ($type) {case "window": if (qInt("windowPref", "-ex", $control)) {windowPref -r $control;}break;case "workspaceControl": if (qInt("workspaceControlState", "-ex", $control)) {workspaceControlState -r $control;}break;default: break;}}proc string buildWorkspaceControl(string $workspaceControlName,string $label,string $buildProcName,string $buildProcFilename) {string $control = $workspaceControlName;if (!qExists($workspaceControlName)) {string $uiScript = "if (!`exists " + $buildProcName + "`)" + " source \"" + $buildProcFilename + "\"; " + $buildProcName + "();";$control = `workspaceControl -dup false -fl true -l $label -rt false -ui $uiScript$workspaceControlName`;}return $control;}

// /////////////////////////////////////////////////////////////////////////////
// ドメイン
// /////////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------
// ノード操作
// -----------------------------------------------------------------------------
/*-
@param $n <string>
@returns <int>
*/
proc int isValidTransform(string $n) {
  return (
    `objExists $n`
        && `nodeType $n` == "transform"
        && `attributeQuery -n $n -ex "shapeTranslate"`
        && `getAttr -typ ($n + ".shapeTranslate")` == "double3"
        && `attributeQuery -n $n -ex "shapeTranslateX"`
        && `getAttr -typ ($n + ".shapeTranslateX")` == "doubleLinear"
        && `attributeQuery -n $n -ex "shapeTranslateY"`
        && `getAttr -typ ($n + ".shapeTranslateY")` == "doubleLinear"
        && `attributeQuery -n $n -ex "shapeTranslateZ"`
        && `getAttr -typ ($n + ".shapeTranslateZ")` == "doubleLinear"
        && `attributeQuery -n $n -ex "shapeRotate"`
        && `getAttr -typ ($n + ".shapeRotate")` == "double3"
        && `attributeQuery -n $n -ex "shapeRotateX"`
        && `getAttr -typ ($n + ".shapeRotateX")` == "doubleAngle"
        && `attributeQuery -n $n -ex "shapeRotateY"`
        && `getAttr -typ ($n + ".shapeRotateY")` == "doubleAngle"
        && `attributeQuery -n $n -ex "shapeRotateZ"`
        && `getAttr -typ ($n + ".shapeRotateZ")` == "doubleAngle"
        && `attributeQuery -n $n -ex "shapeScale"`
        && `getAttr -typ ($n + ".shapeScale")` == "double3"
        && `attributeQuery -n $n -ex "shapeScaleX"`
        && `getAttr -typ ($n + ".shapeScaleX")` == "double"
        && `attributeQuery -n $n -ex "shapeScaleY"`
        && `getAttr -typ ($n + ".shapeScaleY")` == "double"
        && `attributeQuery -n $n -ex "shapeScaleZ"`
        && `getAttr -typ ($n + ".shapeScaleZ")` == "double"
  );
}

/*-
@param $n <string>
@returns <>
*/
proc addTransformAttributes(string $n) {
  if (isValidTransform($n) || `nodeType $n` != "transform") return;
  addAttr -at "double3" -k false -ln "shapeTranslate" -sn "st" $n;
  addAttr -at "doubleLinear" -k false -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $n;
  addAttr -at "doubleLinear" -k false -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $n;
  addAttr -at "doubleLinear" -k false -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $n;
  addAttr -at "double3" -k false -ln "shapeRotate" -sn "sr" $n;
  addAttr -at "doubleAngle" -k false -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $n;
  addAttr -at "doubleAngle" -k false -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $n;
  addAttr -at "doubleAngle" -k false -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $n;
  addAttr -at "double3" -k false -ln "shapeScale" -sn "ss" $n;
  addAttr -at "double" -k false -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $n;
  addAttr -at "double" -k false -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $n;
  addAttr -at "double" -k false -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $n;
  setAttr ($n + ".ss") -typ "double3" 1.0 1.0 1.0;
}

/*-
@param $name <string>
@returns <int>
*/
proc string createTransform(string $name) {
  if (!`size $name`) return "";
  string $n = `createNode -n $name -ss "transform"`;
  addTransformAttributes($n);
  return $n;
}

/*-
@param $n <string>
@returns <int>
*/
proc int isValidNurbsCurve(string $n) {
  return (
    `objExists $n`
        && `nodeType $n` == "nurbsCurve"
        && `attributeQuery -n $n -ex "sourceCurve"`
        && `getAttr -typ ($n + ".sourceCurve")` == "nurbsCurve"
  );
}

/*-
@param $n <string>
@returns <>
*/
proc addCurveAttribute(string $n) {
  if (isValidNurbsCurve($n) || `nodeType $n` != "nurbsCurve") return;
  addAttr -dt "nurbsCurve" -k false -ln "sourceCurve" -sn "sc" $n;
}

/*-
@param $n <string>
@param $validOnly <boolean> `sourceCurve`アトリビュートを持つノードのみ収集するかどうか。
@returns <string[]>
*/
proc string[] collectCurveNodes(string $n, int $validOnly) {
  string $curveNodes[];
  if (`nodeType $n` != "transform") return $curveNodes;
  string $shapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $n`;
  for ($shapeNode in $shapeNodes) {
    if ($validOnly && !isValidNurbsCurve($shapeNode)) continue;
    $curveNodes[`size $curveNodes`] = $shapeNode;
  }
  return $curveNodes;
}

/*-
@param $n <string>
@returns <int>
*/
proc int isEditMode(string $n) {
  if (!isValidTransform($n)) return false;
  string $sources[];
  string $targets[];
  string $nodes[] = getConnections($n, 1, "composeMatrix", $sources, $targets);
  int $numNodes = `size $nodes`;
  int $numSources = `size $sources`;
  int $numTargets = `size $targets`;
  return ($numNodes > 0 && $numSources > 0 && $numTargets == $numSources);
}

/*-
@param $n <string>
@param $state <boolean>
@returns <>
*/
proc setTransformAttributeLock(string $n, int $state) {
  string $attributes[] = {
    ".stx", ".sty", ".stz",
    ".srx", ".sry", ".srz",
    ".ssx", ".ssy", ".ssz"
  };
  for ($attribute in $attributes) {
    setAttr -l $state ($n + $attribute);
  }
}

/*-
@param $n <string>
@param $state <boolean>
@returns <>
*/
proc setTransformAttributeCB(string $n, int $state) {
  string $attributes[] = {
    ".stx", ".sty", ".stz",
    ".srx", ".sry", ".srz",
    ".ssx", ".ssy", ".ssz"
  };
  for ($attribute in $attributes) {
    setAttr -cb $state ($n + $attribute);
  }
}

/*-
@param $n <string>
@param $isEditMode <boolean>
@returns <>
*/
proc setTransformAttributeState(string $n, int $isEditMode) {
  if (!isValidTransform($n)) return;
  setTransformAttributeLock($n, !$isEditMode);
  setTransformAttributeCB($n, $isEditMode);
}

/*-
@param $n <string>
@returns <string[]>
*/
proc string[] renameCurveNodes(string $n) {
  string $newCurveNodes[];
  if (!(`objExists $n` && `nodeType $n` == "transform")) return $newCurveNodes;

  string $baseName = shortNameOf($n);
  string $lastCurveNodes[] = collectCurveNodes($n, false);
  for ($i = 0; $i < `size $lastCurveNodes`; $i++) {
    string $shapeName = $baseName + "Shape" + ($i + 1);
    $newCurveNodes[$i] = `rename $lastCurveNodes[$i] $shapeName`;
  }
  return $newCurveNodes;
}

/*-
@param $nodes <string[]>
@returns <>
*/
proc deleteNodes(string $nodes[]) {
  for ($n in $nodes) {
    if (`objExists $n`) delete $n;
  }
}

// -----------------------------------------------------------------------------
// カーブ定義
// -----------------------------------------------------------------------------
/*-
@param $n <string>
@returns <string>
*/
proc string serializeCurve(string $n) {
  // print("serializeCurve\n"); // debug
  // print("  n:" + $n + "\n"); // debug
  string $text;
  if (!(`objExists $n` && `nodeType $n` == "nurbsCurve")) return $text;

  int $d = `getAttr ($n + ".d")`;
  int $s = `getAttr ($n + ".s")`;
  int $f = `getAttr ($n + ".f")`;
  $text += $d + "," + $s + "," + $f + ",0,3";

  string $curveInfoNode = `createNode -ss "curveInfo"`;
  connectAttr ($n + ".ws") ($curveInfoNode + ".ic");
  float $knotValues[] = `getAttr ($curveInfoNode + ".kn")`;
  delete $curveInfoNode;
  $text += "/" + floatArrayToString($knotValues, ",");

  string $cpValues[];
  int $numCVs = $d + $s;
  for ($i = 0; $i < $numCVs; $i++) {
    float $cp[] = `getAttr ($n + ".cp[" + $i + "]")`;
    $cpValues[$i] = floatArrayToString($cp, ",");
  }
  $text += "/" + stringArrayToString($cpValues, ";");
  return $text;
}

/*-
@param $nodes <string[]>
@returns <string>
*/
proc string bundleCurves(string $nodes[]) {
  // print("bundleCurves\n"); // debug
  // print("  nodes:{\n    " + stringArrayToString($nodes, ",\n    ") + "\n  }\n"); // debug
  string $text;
  if (!`size $nodes`) return $text;

  string $lines[];
  for ($n in $nodes) {
    string $curveNodes[] = collectCurveNodes($n, false);
    // print("  curveNodes    :{\n    " + stringArrayToString($curveNodes, ",\n    ") + "\n  }\n"); // debug
    if (!`size $curveNodes`) continue;

    for ($curveNode in $curveNodes) {
      if (`nodeType $curveNode` != "nurbsCurve") continue;

      // ヒストリを削除しないとCVの値が正しく取得できない
      delete -ch $curveNode;

      string $curveText = serializeCurve($curveNode);
      if (!`size $curveText`) continue;
      $lines[`size $lines`] = $curveText;
    }
  }
  if (!`size $lines`) return $text;

  $text = stringArrayToString($lines, "\n") + "\n";
  return $text;
}

/*-
@param $curveText <string>
@returns <string>
*/
proc string deserializeCurve(string $curveText) {
  // print("deserializeCurve\n"); // debug
  // print("  curveText:" + $curveText + "\n"); // debug
  string $n;
  if (!`size $curveText`) return $n;

  string $createFlags;
  string $sourceCurveValue;

  string $curveBuffer[];
  int $numCurveBuffer = `tokenize $curveText "/" $curveBuffer`;
  // print("  curveBuffer:{\n    " + stringArrayToString($curveBuffer, ",\n    ") + "\n  }\n"); // debug
  if ($numCurveBuffer != 3) return $n;

  string $params[];
  int $numParams = `tokenize $curveBuffer[0] "," $params`;
  // print("  params    :{" + stringArrayToString($params, ", ") + "}\n"); // debug
  if ($numParams != 5) return $n;

  $createFlags += " -d " + $params[0];
  $createFlags += " -os";
  $createFlags += ($params[2] == "2") ? " -per 1" : " -per 0";
  for ($i = 0; $i < $numParams; $i++) {
    $sourceCurveValue += " " + $params[$i];
  }

  string $knotValues[];
  int $numKnotValues = `tokenize $curveBuffer[1] "," $knotValues`;
  // print("  knotValues:{" + stringArrayToString($knotValues, ", ") + "}\n"); // debug
  if (!$numKnotValues) return $n;

  $sourceCurveValue += " " + $numKnotValues;
  for ($i = 0; $i < $numKnotValues; $i++) {
    $createFlags += " -k " + $knotValues[$i];
    $sourceCurveValue += " " + $knotValues[$i];
  }

  string $cvValues[];
  int $numCvValues = `tokenize $curveBuffer[2] ";" $cvValues`;
  // print("  cvValues  :{" + stringArrayToString($cvValues, ", ") + "}\n"); // debug
  if (!$numCvValues) return $n;

  $sourceCurveValue += " " + $numCvValues;
  for ($i = 0; $i < $numCvValues; $i++) {
    string $cvValue[];
    int $numCvValue = `tokenize $cvValues[$i] "," $cvValue`;
    if ($numCvValue != 3) return $n;

    $createFlags += " -p";
    for ($j = 0; $j < $numCvValue; $j++) {
      $createFlags += " " + $cvValue[$j];
      $sourceCurveValue += " " + $cvValue[$j];
    }
  }

  // print("  createFlags     :" + $createFlags + "\n"); // debug
  // print("  sourceCurveValue:" + $sourceCurveValue + "\n"); // debug
  if (!(`size $createFlags` && `size $sourceCurveValue`)) return $n;

  string $createCommand = "curve" + $createFlags;
  // print("  createCommand :" + $createCommand + "\n"); // debug
  $n = `eval $createCommand`;
  // print("  n:" + $n + "\n"); // debug

  if (`objExists $n` && `nodeType $n` == "transform") {
    string $curveNodes[] = collectCurveNodes($n, false);
    if (`size $curveNodes` == 1) {
      string $curveNode = $curveNodes[0];
      addCurveAttribute($curveNode);
      if (isValidNurbsCurve($curveNode)) {
        string $setAttrCommand = "setAttr \"" + $curveNode + ".sc\"";
        $setAttrCommand += " -typ \"nurbsCurve\"";
        $setAttrCommand += $sourceCurveValue + ";";
        // print("  setAttrCommand:" + $setAttrCommand + "\n"); // debug
        eval $setAttrCommand;
      }
    }
  }
  return $n;
}

// -----------------------------------------------------------------------------
// カーブリスト
// -----------------------------------------------------------------------------
/*-
@returns <string>
*/
proc string getCurveDirname() {
  return (getSourceDirname("nkCurveDepot") + "/nkCurveDepotCurves");
}

/*-
@returns <string>
*/
proc string getTrashDirname() {
  return (getCurveDirname() + "/trash");
}

/*-
@returns <string>
*/
proc string getCurveOrderFilename() {
  string $curveDirname = getCurveDirname();
  if (!existsDirname($curveDirname)) makeDirs($curveDirname);
  if (!existsDirname($curveDirname)) return "";
  return ($curveDirname + "/order.txt");
}

/*-
@returns <string[]>
*/
proc string[] readCurveOrder() {
  // print("readCurveOrder\n"); // debug
  string $order[];
  string $orderFilename = getCurveOrderFilename();
  if (!existsFilename($orderFilename)) return $order;
  $order = readAllLines($orderFilename, "");
  // print("  order:{\n    " + stringArrayToString($order, ",\n    ") + "\n  }\n"); // debug
  return $order;
}

/*-
@param $curveNames <string[]>
@returns <boolean> 成功した場合は`true`、失敗した場合は`false`。
*/
proc int writeCurveOrder(string $curveNames[]) {
  // print("writeCurveOrder\n"); // debug
  // print("  curveNames:{\n    " + stringArrayToString($curveNames, ",\n    ") + "\n  }\n"); // debug
  string $orderFilename = getCurveOrderFilename();
  return (writeAllLines($orderFilename, "", $curveNames));
}

/*-
@returns <boolean> 成功した場合は`true`、失敗した場合は`false`。
*/
proc int sortCurveOrder() {
  // print("sortCurveOrder\n"); // debug
  string $curveOrder[] = readCurveOrder();
  // print("  curveOrder:{\n    " + stringArrayToString($curveOrder, ",\n    ") + "\n  }\n"); // debug
  if (!`size $curveOrder`) return false;

  $curveOrder = `sortCaseInsensitive $curveOrder`;
  if (!writeCurveOrder($curveOrder)) return false;
  return true;
}

/*-
@param $index <int>
@returns <string>
*/
proc string getCurveNameByIndex(int $index) {
  // print("getCurveNameByIndex\n"); // debug
  // print("  index:" + $index + "\n"); // debug
  string $curveName;
  string $curveOrder[] = readCurveOrder();
  // print("  curveOrder:{\n    " + stringArrayToString($curveOrder, ",\n    ") + "\n  }\n"); // debug
  if (!isInRangeInt($index, 0, `size $curveOrder` - 1)) return $curveName;
  return $curveOrder[$index];
}

/*-
@param $curveName <string>
@returns <string>
*/
proc string escapeCurveName(string $curveName) {
  // print("escapeCurveName\n"); // debug
  // print("  curveName:" + $curveName + "\n"); // debug
  if (!isValidFilename($curveName)) {
    $curveName = escapeInvalidFileNameChars($curveName, " ");
  }
  return $curveName;
}

/*-
@param $curveName <string>
@returns <string>
*/
proc string makeCurveFilename(string $curveName) {
  return (getCurveDirname() + "/" + $curveName + ".curvedepot");
}

/*-
@param $curveName <string>
@returns <string>
*/
proc string makeTrashFilename(string $curveName) {
  return (getTrashDirname() + "/" + $curveName + ".curvedepot");
}

/*-
@param $curveName <string>
@param $nodes <string[]>
@returns <boolean> 成功した場合は`true`、失敗した場合は`false`。
*/
proc int addCurve(string $curveName, string $nodes[]) {
  // print("addCurve\n"); // debug
  // print("  curveName:" + $curveName + "\n"); // debug
  $curveName = escapeCurveName($curveName);
  // print("  curveName:" + $curveName + "\n"); // debug
  if (!`size $curveName`) return false;
  if (!`size $nodes`) return false;

  string $curveFilename = makeCurveFilename($curveName);
  string $curveText = bundleCurves($nodes);
  // print("  curveText :" + $curveText + "\n"); // debug
  if (!`size $curveText`) return false;

  string $curveOrder[] = readCurveOrder();
  // print("  curveOrder:{\n    " + stringArrayToString($curveOrder, ",\n    ") + "\n  }\n"); // debug
  if (stringArrayContains($curveName, $curveOrder)) return false;

  if (!writeAllText($curveFilename, "", $curveText)) return false;
  $curveOrder[`size $curveOrder`] = $curveName;
  if (!writeCurveOrder($curveOrder)) return false;
  return true;
}

/*-
@param $index <int> 基数`0`の整数。
@returns <boolean> 成功した場合は`true`、失敗した場合は`false`。
*/
proc int deleteCurve(int $index) {
  // print("deleteCurve\n"); // debug
  // print("  index:" + $index + "\n"); // debug
  string $curveOrder[] = readCurveOrder();
  // print("  curveOrder:{\n    " + stringArrayToString($curveOrder, ",\n    ") + "\n  }\n"); // debug
  if (!isInRangeInt($index, 0, `size $curveOrder` - 1)) return false;

  string $curveName = $curveOrder[$index];
  string $curveFilename = makeCurveFilename($curveName);
  if (!existsFilename($curveFilename)) return false;

  string $trashDirname = getTrashDirname();
  if (!existsDirname($trashDirname)) makeDirs($trashDirname);
  if (existsDirname($trashDirname)) {
    string $trashFilename = makeTrashFilename($curveName);
    if (existsFilename($trashFilename)) deleteFile($trashFilename);
    if (!moveFile($curveFilename, $trashFilename)) return false;
  }

  // 移動に失敗した場合は削除
  if (existsFilename($curveFilename)) {
    if (!deleteFile($curveFilename)) return false;
  }

  if (!stringArrayRemoveAtIndex($index, $curveOrder)) return false;
  if (!writeCurveOrder($curveOrder)) return false;
  return true;
}

/*-
@param $index <int> 基数`0`の整数。
@param $newName <string>
@returns <boolean> 成功した場合は`true`、失敗した場合は`false`。
*/
proc int renameCurve(int $index, string $newName) {
  // print("renameCurve\n"); // debug
  // print("  index  :" + $index + "\n"); // debug
  // print("  newName:" + $newName + "\n"); // debug
  $newName = escapeCurveName($newName);
  // print("  newName:" + $newName + "\n"); // debug
  if (!`size $newName`) return false;

  string $curveOrder[] = readCurveOrder();
  // print("  curveOrder:{\n    " + stringArrayToString($curveOrder, ",\n    ") + "\n  }\n"); // debug
  if (!isInRangeInt($index, 0, `size $curveOrder` - 1)) return false;

  string $lastCurveFilename = makeCurveFilename($curveOrder[$index]);
  string $newCurveFilename = makeCurveFilename($newName);
  // print("  lastCurveFilename:" + $lastCurveFilename + "\n"); // debug
  // print("  newCurveFilename :" + $newCurveFilename + "\n"); // debug
  if (!existsFilename($lastCurveFilename)) return false;
  if (!moveFile($lastCurveFilename, $newCurveFilename)) return false;

  $curveOrder[$index] = $newName;
  if (!writeCurveOrder($curveOrder)) return false;
  return true;
}

/*-
@param $fromIndex <int> 基数`0`の整数。
@returns <boolean> 成功した場合は`true`、失敗した場合は`false`。
*/
proc int movePrevCurve(int $fromIndex) {
  // print("movePrevCurve\n"); // debug
  // print("  fromIndex:" + $fromIndex + "\n"); // debug
  string $curveOrder[] = readCurveOrder();
  // print("  curveOrder:{\n    " + stringArrayToString($curveOrder, ",\n    ") + "\n  }\n"); // debug
  if (!isInRangeInt($fromIndex, 1, `size $curveOrder` - 1)) return false;

  string $curveName = $curveOrder[$fromIndex];
  int $destIndex = $fromIndex - 1;
  if (!stringArrayRemoveAtIndex($fromIndex, $curveOrder)) return false;
  if (!stringArrayInsertAtIndex($destIndex, $curveOrder, $curveName)) return false;
  if (!writeCurveOrder($curveOrder)) return false;
  return true;
}

/*-
@param $fromIndex <int> 基数`0`の整数。
@returns <boolean> 成功した場合は`true`、失敗した場合は`false`。
*/
proc int moveNextCurve(int $fromIndex) {
  // print("moveNextCurve\n"); // debug
  // print("  fromIndex:" + $fromIndex + "\n"); // debug
  string $curveOrder[] = readCurveOrder();
  // print("  curveOrder:{\n    " + stringArrayToString($curveOrder, ",\n    ") + "\n  }\n"); // debug
  if (!isInRangeInt($fromIndex, 0, `size $curveOrder` - 2)) return false;

  string $curveName = $curveOrder[$fromIndex];
  int $destIndex = $fromIndex + 1;
  if (!stringArrayRemoveAtIndex($fromIndex, $curveOrder)) return false;
  if (!stringArrayInsertAtIndex($destIndex, $curveOrder, $curveName)) return false;
  if (!writeCurveOrder($curveOrder)) return false;
  return true;
}

// -----------------------------------------------------------------------------
// カーブ操作
// -----------------------------------------------------------------------------
/*-
@param $curveName <string>
@returns <string> 作成したカーブのトランスフォームノード。
*/
proc string createCurve(string $curveName) {
  // print("createCurve\n"); // debug
  // print("  curveName:" + $curveName + "\n"); // debug
  string $n;
  if (!`size $curveName`) return $n;

  string $curveFilename = makeCurveFilename($curveName);
  if (!existsFilename($curveFilename)) return $n;

  string $lines[] = readAllLines($curveFilename, "");
  if (!`size $lines`) return $n;

  string $curveNodes[];
  string $deletableNodes[];
  for ($line in $lines) {
    string $t = deserializeCurve($line);
    if (!(`objExists $t` && `nodeType $t` == "transform")) continue;
    string $ncs[] = collectCurveNodes($t, true);
    if (!`size $ncs`) continue;
    $curveNodes[`size $curveNodes`] = $ncs[0];
    $deletableNodes[`size $deletableNodes`] = $t;
  }
  if (!`size $curveNodes`) return $n;

  $n = createTransform("controller");
  setTransformAttributeState($n, false);
  if (isValidTransform($n)) {
    parent -r -s $curveNodes $n;
    renameCurveNodes($n);
  }
  if (`size $deletableNodes` > 0) delete $deletableNodes;
  select -r $n;
  return $n;
}

/*-
@param $nodes <string[]>
@returns <string[]> 作成した編集用ノードの配列。
*/
proc string[] buildEditableGraph(string $nodes[]) {
  // print("buildEditableGraph\n"); // debug
  // print("  nodes:{\n    " + stringArrayToString($nodes, ",\n    ") + "\n  }\n"); // debug
  string $newNodes[];
  if (!`size $nodes`) return $newNodes;

  for ($t in $nodes) {
    // print("  t:" + $t + "\n"); // debug
    if (!isValidTransform($t)) continue;

    setTransformAttributeState($t, true);
    if (isEditMode($t)) continue;

    string $curveNodes[] = collectCurveNodes($t, true);
    // print("    curveNodes:{\n      " + stringArrayToString($curveNodes, ",\n      ") + "\n    }\n"); // debug
    int $numCurveNodes = `size $curveNodes`;
    if (!$numCurveNodes) continue;

    string $tm = `createNode -ss "composeMatrix"`;
    connectAttr -f ($t + ".st") ($tm + ".it");
    connectAttr -f ($t + ".sr") ($tm + ".ir");
    connectAttr -f ($t + ".ss") ($tm + ".is");
    $newNodes[`size $newNodes`] = $tm;

    string $tcm = `createNode -ss "colorMath"`;
    connectAttr -f ($t + ".st") ($tcm + "._ca");
    connectAttr -f ($t + ".rp") ($tcm + "._cb");
    $newNodes[`size $newNodes`] = $tcm;

    for ($i = 0; $i < $numCurveNodes; $i++) {
      string $nc = $curveNodes[$i];
      if (!isValidNurbsCurve($nc)) continue;

      int $d = `getAttr ($nc + ".d")`;
      int $s = `getAttr ($nc + ".s")`;
      int $f = `getAttr ($nc + ".f")`;
      int $numEPs = $s + 1;
      int $numCVs = $d + $s;

      string $ci = `createNode -ss "curveInfo"`;
      connectAttr ($nc + ".sc") ($ci + ".ic");
      $newNodes[`size $newNodes`] = $ci;

      for ($j = 0; $j < $numCVs; $j++) {
        string $civp = `createNode -ss "vectorProduct"`;
        string $cicm = `createNode -ss "colorMath"`;
        $newNodes[`size $newNodes`] = $civp;
        $newNodes[`size $newNodes`] = $cicm;
        setAttr ($civp + ".op") 3;
        setAttr ($cicm + "._cnd") 0;
        connectAttr -f ($ci + ".cp[" + $j + "]") ($civp + ".i1");
        connectAttr -f ($tm + ".omat") ($civp + ".m");
        connectAttr -f ($civp + ".o") ($cicm + "._ca");
        connectAttr -f ($tcm + ".oc") ($cicm + "._cb");
        connectAttr -f ($cicm + ".oc") ($nc + ".cp[" + $j + "]");
      }
    }
  }
  if (`size $newNodes` > 0) dgdirty $newNodes;
  return $newNodes;
}

/*-
@param $nodes <string[]>
@returns <>
*/
proc removeEditableGraph(string $nodes[]) {
  // print("removeEditableGraph\n"); // debug
  // print("  nodes:{\n    " + stringArrayToString($nodes, ",\n    ") + "\n  }\n"); // debug
  if (!`size $nodes`) return;

  for ($t in $nodes) {
    // print("  t:" + $t + "\n"); // debug
    if (!isValidTransform($t)) continue;

    setTransformAttributeState($t, false);
    if (!isEditMode($t)) continue;

    string $curveNodes[] = collectCurveNodes($t, true);
    // print("    curveNodes:{\n      " + stringArrayToString($curveNodes, ",\n      ") + "\n    }\n"); // debug
    int $numCurveNodes = `size $curveNodes`;
    if (!$numCurveNodes) continue;

    string $tmSources[];
    string $tmTargets[];
    string $tms[] = getConnections($t, 1, "composeMatrix", $tmSources, $tmTargets);
    // print("    tms:{\n      " + stringArrayToString($tms, ",\n      ") + "\n    }\n"); // debug
    // print("    tmSources:{\n      " + stringArrayToString($tmSources, ",\n      ") + "\n    }\n"); // debug
    // print("    tmTargets:{\n      " + stringArrayToString($tmTargets, ",\n      ") + "\n    }\n"); // debug
    int $numTmSources = `size $tmSources`;
    if (`size $tms` != 1) continue;
    if ($numTmSources != 3) continue;
    if (`size $tmTargets` != $numTmSources) continue;

    string $tmvpSources[];
    string $tmvpTargets[];
    string $tmvps[] = getConnections($tms[0], 1, "vectorProduct", $tmvpSources, $tmvpTargets);
    // print("    tmvps:{\n      " + stringArrayToString($tmvps, ",\n      ") + "\n    }\n"); // debug
    // print("    tmvpSources:{\n      " + stringArrayToString($tmvpSources, ",\n      ") + "\n    }\n"); // debug
    // print("    tmvpTargets:{\n      " + stringArrayToString($tmvpTargets, ",\n      ") + "\n    }\n"); // debug
    int $numTmvpSources = `size $tmvpSources`;
    if (!`size $tmvps`) continue;
    if (!$numTmvpSources) continue;
    if (`size $tmvpTargets` != $numTmvpSources) continue;

    string $tcmSources[];
    string $tcmTargets[];
    string $tcms[] = getConnections($t, 1, "colorMath", $tcmSources, $tcmTargets);
    // print("    tcms:{\n      " + stringArrayToString($tcms, ",\n      ") + "\n    }\n"); // debug
    // print("    tcmSources:{\n      " + stringArrayToString($tcmSources, ",\n      ") + "\n    }\n"); // debug
    // print("    tcmTargets:{\n      " + stringArrayToString($tcmTargets, ",\n      ") + "\n    }\n"); // debug
    int $numTcmSources = `size $tcmSources`;
    if (`size $tcms` != 1) continue;
    if ($numTcmSources != 2) continue;
    if (`size $tcmTargets` != $numTcmSources) continue;

    string $tcmcmSources[];
    string $tcmcmTargets[];
    string $tcmcms[] = getConnections($tcms[0], 1, "colorMath", $tcmcmSources, $tcmcmTargets);
    // print("    tcmcms:{\n      " + stringArrayToString($tcmcms, ",\n      ") + "\n    }\n"); // debug
    // print("    tcmcmSources:{\n      " + stringArrayToString($tcmcmSources, ",\n      ") + "\n    }\n"); // debug
    // print("    tcmcmTargets:{\n      " + stringArrayToString($tcmcmTargets, ",\n      ") + "\n    }\n"); // debug
    int $numTcmcmSources = `size $tcmcmSources`;
    if (!`size $tcmcms`) continue;
    if (!$numTcmcmSources) continue;
    if (`size $tcmcmTargets` != $numTcmcmSources) continue;

    disconnectAttributes($tmSources, $tmTargets);
    disconnectAttributes($tmvpSources, $tmvpTargets);
    disconnectAttributes($tcmSources, $tcmTargets);
    disconnectAttributes($tcmcmSources, $tcmcmTargets);
    deleteNodes($tms);
    deleteNodes($tcms);

    for ($i = 0; $i < $numCurveNodes; $i++) {
      string $nc = $curveNodes[$i];
      // print("    nc:" + $nc + "\n"); // debug
      if (!isValidNurbsCurve($nc)) continue;

      int $d = `getAttr ($nc + ".d")`;
      int $s = `getAttr ($nc + ".s")`;
      int $numCVs = $d + $s;

      string $cicmSources[];
      string $cicmTargets[];
      string $cicms[] = getConnections($nc, 0, "colorMath", $cicmSources, $cicmTargets);
      // print("      cicms:{\n        " + stringArrayToString($cicms, ",\n        ") + "\n      }\n"); // debug
      // print("      cicmSources:{\n        " + stringArrayToString($cicmSources, ",\n        ") + "\n      }\n"); // debug
      // print("      cicmTargets:{\n        " + stringArrayToString($cicmTargets, ",\n        ") + "\n      }\n"); // debug
      int $numCicmSources = `size $cicmSources`;
      if (`size $cicms` != $numCVs) continue;
      if ($numCicmSources != $numCVs) continue;
      if (`size $cicmTargets` != $numCicmSources) continue;

      disconnectAttributes($cicmSources, $cicmTargets);

      string $ciSources[];
      string $ciTargets[];
      string $cis[] = getConnections($nc, 1, "curveInfo", $ciSources, $ciTargets);
      // print("      cis:{\n        " + stringArrayToString($cis, ",\n        ") + "\n      }\n"); // debug
      // print("      ciSources:{\n        " + stringArrayToString($ciSources, ",\n        ") + "\n      }\n"); // debug
      // print("      ciTargets:{\n        " + stringArrayToString($ciTargets, ",\n        ") + "\n      }\n"); // debug
      int $numCiSources = `size $ciSources`;
      if (`size $cis` != 1) continue;
      if ($numCiSources != 1) continue;
      if (`size $ciTargets` != $numCiSources) continue;

      string $civpSources[];
      string $civpTargets[];
      string $civps[] = getConnections($cis[0], 1, "vectorProduct", $civpSources, $civpTargets);
      // print("      civps:{\n        " + stringArrayToString($civps, ",\n        ") + "\n      }\n"); // debug
      // print("      civpSources:{\n        " + stringArrayToString($civpSources, ",\n        ") + "\n      }\n"); // debug
      // print("      civpTargets:{\n        " + stringArrayToString($civpTargets, ",\n        ") + "\n      }\n"); // debug
      int $numCivpSources = `size $civpSources`;
      if (`size $civps` != $numCVs) continue;
      if ($numCivpSources != $numCVs) continue;
      if (`size $civpTargets` != $numCivpSources) continue;

      // vectorProductへの接続を先に切る
      disconnectAttributes($civpSources, $civpTargets);

      // 接続を切らずに削除
      // disconnectAttributes($ciSources, $ciTargets);
      deleteNodes($cis);

      deleteNodes($civps);
      deleteNodes($cicms);
    }
  }
}

/*-
@param $nodes <string[]>
@param $state <boolean>
@returns <>
*/
proc lockCurve(string $nodes[], int $state) {
  if ($state) {
    removeEditableGraph($nodes);
  }
  else {
    buildEditableGraph($nodes);
  }
  refresh;
}

/*-
@param $nodes <string[]>
@returns <string[]>
*/
proc string[] replaceCurves(string $nodes[]) {
  // print("replaceCurves\n"); // debug
  // print("  nodes:{\n    " + stringArrayToString($nodes, ",\n    ") + "\n  }\n"); // debug
  string $newNodes[];
  if (`size $nodes` != 2) return $newNodes;

  string $sourceNode = $nodes[0];
  string $targetNode = $nodes[1];
  // print("  sourceNode:" + $sourceNode + "\n"); // debug
  // print("  targetNode:" + $targetNode + "\n"); // debug
  if (!isValidTransform($sourceNode)) return $newNodes;
  if (`nodeType $targetNode` != "transform") return $newNodes;

  if (isEditMode($sourceNode)) removeEditableGraph({$sourceNode});
  if (isEditMode($sourceNode)) return $newNodes;

  if (isValidTransform($targetNode)) {
    if (isEditMode($targetNode)) removeEditableGraph({$targetNode});
    if (isEditMode($targetNode)) return $newNodes;
  }

  // 念のためヒストリを削除しておく
  delete -ch $targetNode;

  string $sourceCurveNodes[] = collectCurveNodes($sourceNode, true);
  // print("  sourceCurveNodes:{\n    " + stringArrayToString($sourceCurveNodes, ",\n    ") + "\n  }\n"); // debug
  if (!`size $sourceCurveNodes`) return $newNodes;

  string $targetCurveNodes[] = collectCurveNodes($targetNode, false);
  // print("  targetCurveNodes:{\n    " + stringArrayToString($targetCurveNodes, ",\n    ") + "\n  }\n"); // debug

  if (`size $targetCurveNodes`) deleteNodes($targetCurveNodes);

  if (!isValidTransform($targetNode)) addTransformAttributes($targetNode);
  if (!isValidTransform($targetNode)) return $newNodes;

  float $st[] = `getAttr ($sourceNode + ".st")`;
  float $sr[] = `getAttr ($sourceNode + ".sr")`;
  float $ss[] = `getAttr ($sourceNode + ".ss")`;
  // print("  st:{" + floatArrayToString($st, ", ") + "}\n"); // debug
  // print("  sr:{" + floatArrayToString($sr, ", ") + "}\n"); // debug
  // print("  ss:{" + floatArrayToString($ss, ", ") + "}\n"); // debug
  setTransformAttributeLock($targetNode, false);
  setAttr ($targetNode + ".st") -typ "double3" $st[0] $st[1] $st[2];
  setAttr ($targetNode + ".sr") -typ "double3" $sr[0] $sr[1] $sr[2];
  setAttr ($targetNode + ".ss") -typ "double3" $ss[0] $ss[1] $ss[2];

  parent -r -s $sourceCurveNodes $targetNode;
  $newNodes = renameCurveNodes($targetNode);

  // ピボットのオフセットを反映させる
  buildEditableGraph({$targetNode});
  removeEditableGraph({$targetNode});
  refresh;

  if (`objExists $sourceNode`) delete $sourceNode;
  select -r $targetNode;
  return $newNodes;
}

// -----------------------------------------------------------------------------
// スクリプトジョブ
// -----------------------------------------------------------------------------
// /*-
// @returns <>
// */
// proc registerScriptJob() {
// }

// /*-
// @returns <>
// */
// proc unregisterScriptJob() {
// }

// /////////////////////////////////////////////////////////////////////////////
// プレゼンテーション
// /////////////////////////////////////////////////////////////////////////////
/*-
@param $initCurveName <string>
@returns <string>
*/
proc string makeCurveName(string $initCurveName) {
  string $result = `promptDialog
      -b "OK" -db "OK"
      -b "Cancel"-cb "Cancel"
      -m "Enter Curve Name:"
      -t "Curve Name"
      -tx $initCurveName`;
  if ($result != "OK") return $initCurveName;
  return `promptDialog -q -tx`;
}

/*-
@returns <int>
*/
proc int getCurveListSelectedIndex() {
  string $curveList = getUIControl("nkCurveDepotWindow", "curveList");
  return (qFirstIndex("textScrollList", "-sii", $curveList));
}

/*-
@returns <string>
*/
proc string getCurveListSelectedItem() {
  string $curveList = getUIControl("nkCurveDepotWindow", "curveList");
  return (qFirstString("textScrollList", "-si", $curveList));
}

/*-
@param $index <int>
@returns <>
*/
proc selectCurveListByIndex(int $index) {
  string $curveList = getUIControl("nkCurveDepotWindow", "curveList");
  executeUIControl("textScrollList", "-da", $curveList);
  int $numItems = qInt("textScrollList", "-ni", $curveList);
  if (!isInRangeInt($index, 0, $numItems - 1)) return;
  eIndex("textScrollList", "-sii", $index, $curveList);
}

/*-
@param $item <string>
@returns <>
*/
proc selectCurveListByItem(string $item) {
  if (!`size $item`) return;
  string $curveList = getUIControl("nkCurveDepotWindow", "curveList");
  executeUIControl("textScrollList", "-da", $curveList);
  int $numItems = qInt("textScrollList", "-ni", $curveList);
  if (!$numItems) return;
  eStringArray("textScrollList", "-si", {$item}, $curveList);
}

/*-
@param $stateOfSelection <string> 更新後の選択状態。
| 値          | 説明                             |
| ----------- | -------------------------------- |
| `none`      | 選択無し                         |
| `keepIndex` | 前回の選択インデックスを引き継ぐ |
| `keepItem`  | 前回の選択アイテムを引き継ぐ     |
| `last`      | 末尾のアイテムを選択             |
| `prev`      | 前に一つずらす                   |
| `next`      | 後に一つずらす                   |
@returns <>
*/
proc updateCurveList(string $stateOfSelection) {
  // print("updateCurveList\n"); // debug
  // print("  stateOfSelection:" + $stateOfSelection + "\n"); // debug

  int $lastIndex = getCurveListSelectedIndex();
  string $lastItem = getCurveListSelectedItem();
  // print("  lastIndex:" + $lastIndex + "\n"); // debug
  // print("  lastItem :" + $lastItem + "\n"); // debug

  string $curveList = getUIControl("nkCurveDepotWindow", "curveList");
  executeUIControl("textScrollList", "-ra", $curveList);

  string $curveOrder[] = readCurveOrder();
  // print("  curveOrder:{\n    " + stringArrayToString($curveOrder, ",\n    ") + "\n  }\n"); // debug
  for ($curveName in $curveOrder) {
    eString("textScrollList", "-a", $curveName, $curveList);
  }

  switch ($stateOfSelection) {
    case "none": selectCurveListByIndex(-1); break;
    case "keepIndex": selectCurveListByIndex($lastIndex); break;
    case "keepItem": selectCurveListByItem($lastItem); break;
    case "last": selectCurveListByIndex(`size $curveOrder` - 1); break;
    case "prev": selectCurveListByIndex($lastIndex - 1); break;
    case "next": selectCurveListByIndex($lastIndex + 1); break;
    default: break;
  }
}

// -----------------------------------------------------------------------------
// UIコントロールイベントハンドラ
// -----------------------------------------------------------------------------
/*-
@returns <>
*/
proc nkCurveDepotWindowClosed() {
  // print("nkCurveDepotWindowClosed\n"); // debug
  unsubscribePosesObservers();
  removeUIControls("nkCurveDepotWindow", "");
}

/*-
@returns <>
*/
proc resetWindowMenuItemSelected() {
  // print("resetWindowMenuItemSelected\n"); // debug
  string $nkCurveDepotWindow = getUIControl("nkCurveDepotWindow", "nkCurveDepotWindow");
  // print("  nkCurveDepotWindow:" + $nkCurveDepotWindow + "\n"); // debug
  windowPrefRemove("window", $nkCurveDepotWindow);
  nkCurveDepot();
}

/*-
@returns <>
*/
proc quitMenuItemSelected() {
  // print("quitMenuItemSelected\n"); // debug
  string $nkCurveDepotWindow = getUIControl("nkCurveDepotWindow", "nkCurveDepotWindow");
  // print("  nkCurveDepotWindow:" + $nkCurveDepotWindow + "\n"); // debug
  windowClose($nkCurveDepotWindow);
}

/*-
@returns <>
*/
proc aboutMenuItemSelected() {
  // print("aboutMenuItemSelected\n"); // debug
  confirmDialog
      -b "OK"
      -db "OK"
      -m (
        "nkCurveDepot " + (nkCurveDepotVersion())
            + "\n\nMIT License\nhttps://github.com/imaoki/nkCurveDepot"
      )
      -p (getParentableWindow("nkCurveDepotWindow"))
      -t "About - nkCurveDepot";
}

/*-
@returns <>
*/
proc curve1ButtonPressed() {
  // print("curve1ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 3 -per 1 -k -2 -k -1 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -p 0.7836116249 4.798237341e-17 -0.7836116249 -p 6.785732323e-17 6.785732323e-17 -1.108194188 -p -0.7836116249 4.798237341e-17 -0.7836116249 -p -1.108194188 3.517735619e-33 -5.744898238e-17 -p -0.7836116249 -4.798237341e-17 0.7836116249 -p -1.110085697e-16 -6.785732323e-17 1.108194188 -p 0.7836116249 -4.798237341e-17 0.7836116249 -p 1.108194188 -9.25367921e-33 1.511240501e-16 -p 0.7836116249 4.798237341e-17 -0.7836116249 -p 6.785732323e-17 6.785732323e-17 -1.108194188 -p -0.7836116249 4.798237341e-17 -0.7836116249`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 3 8 2 0 3 13 -2 -1 0 1 2 3 4 5 6 7 8 9 10 11 0.7836116249 4.798237341e-17 -0.7836116249 6.785732323e-17 6.785732323e-17 -1.108194188 -0.7836116249 4.798237341e-17 -0.7836116249 -1.108194188 3.517735619e-33 -5.744898238e-17 -0.7836116249 -4.798237341e-17 0.7836116249 -1.110085697e-16 -6.785732323e-17 1.108194188 0.7836116249 -4.798237341e-17 0.7836116249 1.108194188 -9.25367921e-33 1.511240501e-16 0.7836116249 4.798237341e-17 -0.7836116249 6.785732323e-17 6.785732323e-17 -1.108194188 -0.7836116249 4.798237341e-17 -0.7836116249; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve2ButtonPressed() {
  // print("curve2ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 3 -per 0 -k 4.222677797 -k 4.222677797 -k 4.222677797 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -k 11 -k 11.77732231 -k 11.77732231 -k 11.77732231 -k 12.77732231 -k 12.77732231 -k 12.77732231 -k 13.77732231 -k 13.77732231 -k 13.77732231 -p 0.1736481769 0 0.9842553434 -p 0.3737389585 0 0.94802159 -p 0.8077040682 0 0.7254473214 -p 1.108194188 0 -1.103370867e-14 -p 0.7836116249 0 -0.7836116249 -p 1.097967203e-13 0 -1.108194188 -p -0.7836116249 0 -0.7836116249 -p -1.108194188 0 -2.348671079e-12 -p -0.8077040565 0 0.7254473497 -p -0.3737389057 0 0.948021617 -p -0.1736480935 0 0.9842553585 -p -0.1157655319 0 1.056538328 -p -0.05788276593 0 1.128269164 -p 0 0 1.2 -p 0.05788266659 0 1.128269184 -p 0.1157653332 0 1.056538367 -p 0.1736479998 0 0.9848075509`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 3 14 0 0 3 19 4.222677797 4.222677797 4.222677797 5 6 7 8 9 10 11 11.77732231 11.77732231 11.77732231 12.77732231 12.77732231 12.77732231 13.77732231 13.77732231 13.77732231 17 0.1736481769 0 0.9842553434 0.3737389585 0 0.94802159 0.8077040682 0 0.7254473214 1.108194188 0 -1.103370867e-14 0.7836116249 0 -0.7836116249 1.097967203e-13 0 -1.108194188 -0.7836116249 0 -0.7836116249 -1.108194188 0 -2.348671079e-12 -0.8077040565 0 0.7254473497 -0.3737389057 0 0.948021617 -0.1736480935 0 0.9842553585 -0.1157655319 0 1.056538328 -0.05788276593 0 1.128269164 0 0 1.2 0.05788266659 0 1.128269184 0.1157653332 0 1.056538367 0.1736479998 0 0.9848075509; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve3ButtonPressed() {
  // print("curve3ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 1 -k 0 -k 1 -k 2 -k 3 -k 4 -p -1 0 -1 -p 1 0 -1 -p 1 0 1 -p -1 0 1 -p -1 0 -1`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 4 2 0 3 5 0 1 2 3 4 5 -1 0 -1 1 0 -1 1 0 1 -1 0 1 -1 0 -1; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve4ButtonPressed() {
  // print("curve4ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 1 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -p 0 0 1.2 -p 1 0 1 -p 1 0 -1 -p -1 0 -1 -p -1 0 1 -p 0 0 1.2`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 5 2 0 3 6 0 1 2 3 4 5 6 0 0 1.2 1 0 1 1 0 -1 -1 0 -1 -1 0 1 0 0 1.2; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve5ButtonPressed() {
  // print("curve5ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 0 -k 0 -k 1 -k 2 -k 3 -p 0 0 -1 -p 1 0 -1 -p 1 0 1 -p 0 0 1`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 3 0 0 3 4 0 1 2 3 4 0 0 -1 1 0 -1 1 0 1 0 0 1; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve6ButtonPressed() {
  // print("curve6ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -k 11 -k 12 -k 13 -p 0 0 1 -p 1 0 0 -p 0 1 0 -p 0 0 1 -p -1 0 0 -p 0 1 0 -p 0 0 -1 -p -1 0 0 -p 0 -1 0 -p 0 0 -1 -p 1 0 0 -p 0 -1 0 -p 0 0 1 -p -1 0 0`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 13 0 0 3 14 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 0 0 1 1 0 0 0 1 0 0 0 1 -1 0 0 0 1 0 0 0 -1 -1 0 0 0 -1 0 0 0 -1 1 0 0 0 -1 0 0 0 1 -1 0 0; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve7ButtonPressed() {
  // print("curve7ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -k 11 -k 12 -k 13 -k 14 -k 15 -p -1 1 1 -p -1 -1 1 -p 1 -1 1 -p -1 -1 1 -p -1 -1 -1 -p 1 -1 -1 -p 1 -1 1 -p 1 1 1 -p -1 1 1 -p -1 1 -1 -p 1 1 -1 -p 1 -1 -1 -p -1 -1 -1 -p -1 1 -1 -p 1 1 -1 -p 1 1 1`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 15 0 0 3 16 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 -1 1 1 -1 -1 1 1 -1 1 -1 -1 1 -1 -1 -1 1 -1 -1 1 -1 1 1 1 1 -1 1 1 -1 1 -1 1 1 -1 1 -1 -1 -1 -1 -1 -1 1 -1 1 1 -1 1 1 1; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve8ButtonPressed() {
  // print("curve8ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 0 -k 0 -k 1 -p -2.980232239e-08 1 1.000000119 -p -2.980232239e-08 -1 1.000000119`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 1 0 0 3 2 0 1 2 -2.980232239e-08 1 1.000000119 -2.980232239e-08 -1 1.000000119; string $tt1 = `curve -os -d 1 -per 0 -k 0 -k 1 -p 1 1 0 -p 1 -1 0`; string $ss1[] = `listRelatives -f -s -typ "nurbsCurve" $tt1`; string $nc1 = $ss1[0]; $ncs[`size $ncs`] = $nc1; $dts[`size $dts`] = $tt1; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc1; setAttr ($nc1 + ".sc") -typ "nurbsCurve" 1 1 0 0 3 2 0 1 2 1 1 0 1 -1 0; string $tt2 = `curve -os -d 1 -per 0 -k 0 -k 1 -p 0 1 -1.000000477 -p 0 -1 -1.000000477`; string $ss2[] = `listRelatives -f -s -typ "nurbsCurve" $tt2`; string $nc2 = $ss2[0]; $ncs[`size $ncs`] = $nc2; $dts[`size $dts`] = $tt2; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc2; setAttr ($nc2 + ".sc") -typ "nurbsCurve" 1 1 0 0 3 2 0 1 2 0 1 -1.000000477 0 -1 -1.000000477; string $tt3 = `curve -os -d 1 -per 0 -k 0 -k 1 -p -1.000000238 1 0 -p -1.000000238 -1 0`; string $ss3[] = `listRelatives -f -s -typ "nurbsCurve" $tt3`; string $nc3 = $ss3[0]; $ncs[`size $ncs`] = $nc3; $dts[`size $dts`] = $tt3; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc3; setAttr ($nc3 + ".sc") -typ "nurbsCurve" 1 1 0 0 3 2 0 1 2 -1.000000238 1 0 -1.000000238 -1 0; string $tt4 = `curve -os -d 3 -per 1 -k -2 -k -1 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -p 0.7836116249 -1 -0.7836116249 -p 6.785732323e-17 -1 -1.108194188 -p -0.7836116249 -1 -0.7836116249 -p -1.108194188 -1 -5.744898238e-17 -p -0.7836116249 -1 0.7836116249 -p -1.110085697e-16 -1 1.108194188 -p 0.7836116249 -1 0.7836116249 -p 1.108194188 -1 1.511240501e-16 -p 0.7836116249 -1 -0.7836116249 -p 6.785732323e-17 -1 -1.108194188 -p -0.7836116249 -1 -0.7836116249`; string $ss4[] = `listRelatives -f -s -typ "nurbsCurve" $tt4`; string $nc4 = $ss4[0]; $ncs[`size $ncs`] = $nc4; $dts[`size $dts`] = $tt4; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc4; setAttr ($nc4 + ".sc") -typ "nurbsCurve" 3 8 2 0 3 13 -2 -1 0 1 2 3 4 5 6 7 8 9 10 11 0.7836116249 -1 -0.7836116249 6.785732323e-17 -1 -1.108194188 -0.7836116249 -1 -0.7836116249 -1.108194188 -1 -5.744898238e-17 -0.7836116249 -1 0.7836116249 -1.110085697e-16 -1 1.108194188 0.7836116249 -1 0.7836116249 1.108194188 -1 1.511240501e-16 0.7836116249 -1 -0.7836116249 6.785732323e-17 -1 -1.108194188 -0.7836116249 -1 -0.7836116249; string $tt5 = `curve -os -d 3 -per 1 -k -2 -k -1 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -p 0.7836116249 1 -0.7836116249 -p 6.785732323e-17 1 -1.108194188 -p -0.7836116249 1 -0.7836116249 -p -1.108194188 1 -5.744898238e-17 -p -0.7836116249 1 0.7836116249 -p -1.110085697e-16 1 1.108194188 -p 0.7836116249 1 0.7836116249 -p 1.108194188 1 1.511240501e-16 -p 0.7836116249 1 -0.7836116249 -p 6.785732323e-17 1 -1.108194188 -p -0.7836116249 1 -0.7836116249`; string $ss5[] = `listRelatives -f -s -typ "nurbsCurve" $tt5`; string $nc5 = $ss5[0]; $ncs[`size $ncs`] = $nc5; $dts[`size $dts`] = $tt5; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc5; setAttr ($nc5 + ".sc") -typ "nurbsCurve" 3 8 2 0 3 13 -2 -1 0 1 2 3 4 5 6 7 8 9 10 11 0.7836116249 1 -0.7836116249 6.785732323e-17 1 -1.108194188 -0.7836116249 1 -0.7836116249 -1.108194188 1 -5.744898238e-17 -0.7836116249 1 0.7836116249 -1.110085697e-16 1 1.108194188 0.7836116249 1 0.7836116249 1.108194188 1 1.511240501e-16 0.7836116249 1 -0.7836116249 6.785732323e-17 1 -1.108194188 -0.7836116249 1 -0.7836116249; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve9ButtonPressed() {
  // print("curve9ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 0 -k 0 -k 1 -p 1 1 0 -p 1 -1 0`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 1 0 0 3 2 0 1 2 1 1 0 1 -1 0; string $tt1 = `curve -os -d 3 -per 0 -k 0 -k 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 4 -k 4 -k 5 -k 5 -k 5 -k 6 -k 7 -k 8 -k 9 -k 9 -k 9 -k 10 -k 10 -k 10 -p 0 -1 -1 -p 0.2551222882 -1 -1 -p 0.7866524183 -1 -0.7836116249 -p 1.106673791 -1 -9.55198014e-17 -p 0.7866524183 -1 0.7836116249 -p 0.2551222882 -1 1 -p 0 -1 1 -p -2.980232261e-08 -0.3333333333 1.000000119 -p -2.980232261e-08 0.3333333333 1.000000119 -p -2.980232261e-08 1 1.000000119 -p 0.2551222882 1 1 -p 0.7866524183 1 0.7836116249 -p 1.106673791 1 -9.55198014e-17 -p 0.7866524183 1 -0.7836116249 -p 0.2551222882 1 -1 -p 0 1 -1 -p -2.220446049e-16 0.3333333333 -1.000000477 -p -2.220446049e-16 -0.3333333333 -1.000000477 -p -2.220446049e-16 -1 -1.000000477`; string $ss1[] = `listRelatives -f -s -typ "nurbsCurve" $tt1`; string $nc1 = $ss1[0]; $ncs[`size $ncs`] = $nc1; $dts[`size $dts`] = $tt1; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc1; setAttr ($nc1 + ".sc") -typ "nurbsCurve" 3 16 0 0 3 21 0 0 0 1 2 3 4 4 4 5 5 5 6 7 8 9 9 9 10 10 10 19 0 -1 -1 0.2551222882 -1 -1 0.7866524183 -1 -0.7836116249 1.106673791 -1 -9.55198014e-17 0.7866524183 -1 0.7836116249 0.2551222882 -1 1 0 -1 1 -2.980232261e-08 -0.3333333333 1.000000119 -2.980232261e-08 0.3333333333 1.000000119 -2.980232261e-08 1 1.000000119 0.2551222882 1 1 0.7866524183 1 0.7836116249 1.106673791 1 -9.55198014e-17 0.7866524183 1 -0.7836116249 0.2551222882 1 -1 0 1 -1 -2.220446049e-16 0.3333333333 -1.000000477 -2.220446049e-16 -0.3333333333 -1.000000477 -2.220446049e-16 -1 -1.000000477; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve10ButtonPressed() {
  // print("curve10ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -p -1 0 1 -p 1 0 1 -p 0 1 0 -p -1 0 1 -p -1 0 -1 -p 0 1 0 -p 1 0 -1 -p -1 0 -1 -p 1 0 -1 -p 1 0 1`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 9 0 0 3 10 0 1 2 3 4 5 6 7 8 9 10 -1 0 1 1 0 1 0 1 0 -1 0 1 -1 0 -1 0 1 0 1 0 -1 -1 0 -1 1 0 -1 1 0 1; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve11ButtonPressed() {
  // print("curve11ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -p 0 0 1 -p 1 0 0 -p 0 1 0 -p 0 0 1 -p -1 0 0 -p 0 1 0 -p 0 0 -1 -p -1 0 0 -p 0 0 -1 -p 1 0 0`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 9 0 0 3 10 0 1 2 3 4 5 6 7 8 9 10 0 0 1 1 0 0 0 1 0 0 0 1 -1 0 0 0 1 0 0 0 -1 -1 0 0 0 0 -1 1 0 0; string $tt1 = `curve -os -d 1 -per 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -p 0 0 1 -p 1 0 0 -p 0 1 0 -p 0 0 1 -p -1 0 0 -p 0 1 0 -p 0 0 -1 -p -1 0 0 -p 0 0 -1 -p 1 0 0`; string $ss1[] = `listRelatives -f -s -typ "nurbsCurve" $tt1`; string $nc1 = $ss1[0]; $ncs[`size $ncs`] = $nc1; $dts[`size $dts`] = $tt1; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc1; setAttr ($nc1 + ".sc") -typ "nurbsCurve" 1 9 0 0 3 10 0 1 2 3 4 5 6 7 8 9 10 0 0 1 1 0 0 0 1 0 0 0 1 -1 0 0 0 1 0 0 0 -1 -1 0 0 0 0 -1 1 0 0; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve12ButtonPressed() {
  // print("curve12ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 3 -per 1 -k -2 -k -1 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -p 0.7836116249 4.798237341e-17 -0.7836116249 -p 6.785732323e-17 6.785732323e-17 -1.108194188 -p -0.7836116249 4.798237341e-17 -0.7836116249 -p -1.108194188 3.517735619e-33 -5.744898238e-17 -p -0.7836116249 -4.798237341e-17 0.7836116249 -p -1.110085697e-16 -6.785732323e-17 1.108194188 -p 0.7836116249 -4.798237341e-17 0.7836116249 -p 1.108194188 -9.25367921e-33 1.511240501e-16 -p 0.7836116249 4.798237341e-17 -0.7836116249 -p 6.785732323e-17 6.785732323e-17 -1.108194188 -p -0.7836116249 4.798237341e-17 -0.7836116249`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 3 8 2 0 3 13 -2 -1 0 1 2 3 4 5 6 7 8 9 10 11 0.7836116249 4.798237341e-17 -0.7836116249 6.785732323e-17 6.785732323e-17 -1.108194188 -0.7836116249 4.798237341e-17 -0.7836116249 -1.108194188 3.517735619e-33 -5.744898238e-17 -0.7836116249 -4.798237341e-17 0.7836116249 -1.110085697e-16 -6.785732323e-17 1.108194188 0.7836116249 -4.798237341e-17 0.7836116249 1.108194188 -9.25367921e-33 1.511240501e-16 0.7836116249 4.798237341e-17 -0.7836116249 6.785732323e-17 6.785732323e-17 -1.108194188 -0.7836116249 4.798237341e-17 -0.7836116249; string $tt1 = `curve -os -d 3 -per 1 -k -2 -k -1 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -p 0.7836116249 0.7836116249 4.798237341e-17 -p 6.785732323e-17 1.108194188 6.785732323e-17 -p -0.7836116249 0.7836116249 4.798237341e-17 -p -1.108194188 5.744898238e-17 3.517735619e-33 -p -0.7836116249 -0.7836116249 -4.798237341e-17 -p -1.110085697e-16 -1.108194188 -6.785732323e-17 -p 0.7836116249 -0.7836116249 -4.798237341e-17 -p 1.108194188 -1.511240501e-16 -9.25367921e-33 -p 0.7836116249 0.7836116249 4.798237341e-17 -p 6.785732323e-17 1.108194188 6.785732323e-17 -p -0.7836116249 0.7836116249 4.798237341e-17`; string $ss1[] = `listRelatives -f -s -typ "nurbsCurve" $tt1`; string $nc1 = $ss1[0]; $ncs[`size $ncs`] = $nc1; $dts[`size $dts`] = $tt1; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc1; setAttr ($nc1 + ".sc") -typ "nurbsCurve" 3 8 2 0 3 13 -2 -1 0 1 2 3 4 5 6 7 8 9 10 11 0.7836116249 0.7836116249 4.798237341e-17 6.785732323e-17 1.108194188 6.785732323e-17 -0.7836116249 0.7836116249 4.798237341e-17 -1.108194188 5.744898238e-17 3.517735619e-33 -0.7836116249 -0.7836116249 -4.798237341e-17 -1.110085697e-16 -1.108194188 -6.785732323e-17 0.7836116249 -0.7836116249 -4.798237341e-17 1.108194188 -1.511240501e-16 -9.25367921e-33 0.7836116249 0.7836116249 4.798237341e-17 6.785732323e-17 1.108194188 6.785732323e-17 -0.7836116249 0.7836116249 4.798237341e-17; string $tt2 = `curve -os -d 3 -per 1 -k -2 -k -1 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -p -4.798237341e-17 0.7836116249 0.7836116249 -p -6.785732323e-17 1.108194188 6.785732323e-17 -p -4.798237341e-17 0.7836116249 -0.7836116249 -p -3.517735619e-33 5.744898238e-17 -1.108194188 -p 4.798237341e-17 -0.7836116249 -0.7836116249 -p 6.785732323e-17 -1.108194188 -1.110085697e-16 -p 4.798237341e-17 -0.7836116249 0.7836116249 -p 9.25367921e-33 -1.511240501e-16 1.108194188 -p -4.798237341e-17 0.7836116249 0.7836116249 -p -6.785732323e-17 1.108194188 6.785732323e-17 -p -4.798237341e-17 0.7836116249 -0.7836116249`; string $ss2[] = `listRelatives -f -s -typ "nurbsCurve" $tt2`; string $nc2 = $ss2[0]; $ncs[`size $ncs`] = $nc2; $dts[`size $dts`] = $tt2; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc2; setAttr ($nc2 + ".sc") -typ "nurbsCurve" 3 8 2 0 3 13 -2 -1 0 1 2 3 4 5 6 7 8 9 10 11 -4.798237341e-17 0.7836116249 0.7836116249 -6.785732323e-17 1.108194188 6.785732323e-17 -4.798237341e-17 0.7836116249 -0.7836116249 -3.517735619e-33 5.744898238e-17 -1.108194188 4.798237341e-17 -0.7836116249 -0.7836116249 6.785732323e-17 -1.108194188 -1.110085697e-16 4.798237341e-17 -0.7836116249 0.7836116249 9.25367921e-33 -1.511240501e-16 1.108194188 -4.798237341e-17 0.7836116249 0.7836116249 -6.785732323e-17 1.108194188 6.785732323e-17 -4.798237341e-17 0.7836116249 -0.7836116249; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve13ButtonPressed() {
  // print("curve13ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 1 -k 0 -k 1 -k 2 -k 3 -k 4 -p 0 0 1 -p -1 0 0 -p 0 0 -1 -p 1 0 0 -p 0 0 1`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 4 2 0 3 5 0 1 2 3 4 5 0 0 1 -1 0 0 0 0 -1 1 0 0 0 0 1; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve14ButtonPressed() {
  // print("curve14ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 1 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -k 11 -k 12 -k 13 -k 14 -k 15 -k 16 -k 17 -k 18 -k 19 -k 20 -k 21 -k 22 -k 23 -k 24 -k 25 -k 26 -k 27 -k 28 -k 29 -k 30 -k 31 -k 32 -k 33 -k 34 -k 35 -k 36 -k 37 -k 38 -k 39 -k 40 -k 41 -k 42 -k 43 -k 44 -k 45 -k 46 -k 47 -k 48 -p 1.16592586 0 0.07764563709 -p 1.16592586 0 -0.07764580101 -p 0.9659258127 0 -0.1552914977 -p 0.9141620398 0 -0.3484766483 -p 1.048544288 0 -0.515719831 -p 0.970898509 0 -0.650206089 -p 0.7588706017 0 -0.617449224 -p 0.6174492836 0 -0.7588706017 -p 0.650206089 0 -0.970898509 -p 0.5157197118 0 -1.048544288 -p 0.3484765291 0 -0.9141620398 -p 0.1552913189 0 -0.9659258723 -p 0.07764555514 0 -1.165925741 -p -0.07764591277 0 -1.165925741 -p -0.1552916169 0 -0.9659257531 -p -0.3484767675 0 -0.9141619205 -p -0.5157198906 0 -1.048544168 -p -0.6502062082 0 -0.970898509 -p -0.6174492836 0 -0.7588706017 -p -0.7588706017 0 -0.6174492836 -p -0.970898509 0 -0.6502061486 -p -1.048544168 0 -0.515719831 -p -0.9141620398 0 -0.3484766483 -p -0.9659258127 0 -0.1552915424 -p -1.16592586 0 -0.07764587551 -p -1.16592586 0 0.07764551789 -p -0.9659258723 0 0.1552912444 -p -0.9141620398 0 0.3484764099 -p -1.048544288 0 0.5157196522 -p -0.970898509 0 0.650206089 -p -0.7588704824 0 0.6174492836 -p -0.6174491644 0 0.7588707209 -p -0.6502059698 0 0.9708986282 -p -0.5157197118 0 1.048544407 -p -0.3484765589 0 0.9141620398 -p -0.1552914381 0 0.9659258127 -p -0.0776457116 0 1.16592586 -p 0.0776457265 0 1.16592586 -p 0.155291453 0 0.9659258127 -p 0.3484766483 0 0.9141620398 -p 0.515719831 0 1.048544168 -p 0.6502061486 0 0.970898509 -p 0.6174492836 0 0.7588706017 -p 0.7588706017 0 0.617449224 -p 0.970898509 0 0.6502060294 -p 1.048544288 0 0.5157197118 -p 0.9141620398 0 0.3484765291 -p 0.9659258127 0 0.1552913636 -p 1.16592586 0 0.07764563709`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 48 2 0 3 49 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 1.16592586 0 0.07764563709 1.16592586 0 -0.07764580101 0.9659258127 0 -0.1552914977 0.9141620398 0 -0.3484766483 1.048544288 0 -0.515719831 0.970898509 0 -0.650206089 0.7588706017 0 -0.617449224 0.6174492836 0 -0.7588706017 0.650206089 0 -0.970898509 0.5157197118 0 -1.048544288 0.3484765291 0 -0.9141620398 0.1552913189 0 -0.9659258723 0.07764555514 0 -1.165925741 -0.07764591277 0 -1.165925741 -0.1552916169 0 -0.9659257531 -0.3484767675 0 -0.9141619205 -0.5157198906 0 -1.048544168 -0.6502062082 0 -0.970898509 -0.6174492836 0 -0.7588706017 -0.7588706017 0 -0.6174492836 -0.970898509 0 -0.6502061486 -1.048544168 0 -0.515719831 -0.9141620398 0 -0.3484766483 -0.9659258127 0 -0.1552915424 -1.16592586 0 -0.07764587551 -1.16592586 0 0.07764551789 -0.9659258723 0 0.1552912444 -0.9141620398 0 0.3484764099 -1.048544288 0 0.5157196522 -0.970898509 0 0.650206089 -0.7588704824 0 0.6174492836 -0.6174491644 0 0.7588707209 -0.6502059698 0 0.9708986282 -0.5157197118 0 1.048544407 -0.3484765589 0 0.9141620398 -0.1552914381 0 0.9659258127 -0.0776457116 0 1.16592586 0.0776457265 0 1.16592586 0.155291453 0 0.9659258127 0.3484766483 0 0.9141620398 0.515719831 0 1.048544168 0.6502061486 0 0.970898509 0.6174492836 0 0.7588706017 0.7588706017 0 0.617449224 0.970898509 0 0.6502060294 1.048544288 0 0.5157197118 0.9141620398 0 0.3484765291 0.9659258127 0 0.1552913636 1.16592586 0 0.07764563709; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc curve15ButtonPressed() {
  // print("curve15ButtonPressed\n"); // debug
  {string $t = `group -em -n "bundleCurve1"`; addAttr -at "double3" -k 0 -ln "shapeTranslate" -sn "st" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateX" -sn "stx" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateY" -sn "sty" -p "shapeTranslate" $t; addAttr -at "doubleLinear" -k 0 -ln "shapeTranslateZ" -sn "stz" -p "shapeTranslate" $t; addAttr -at "double3" -k 0 -ln "shapeRotate" -sn "sr" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateX" -sn "srx" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateY" -sn "sry" -p "shapeRotate" $t; addAttr -at "doubleAngle" -k 0 -ln "shapeRotateZ" -sn "srz" -p "shapeRotate" $t; addAttr -at "double3" -k 0 -ln "shapeScale" -sn "ss" $t; addAttr -at "double" -k 0 -ln "shapeScaleX" -sn "ssx" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleY" -sn "ssy" -p "shapeScale" $t; addAttr -at "double" -k 0 -ln "shapeScaleZ" -sn "ssz" -p "shapeScale" $t; setAttr ($t + ".ss") -typ "double3" 1.0 1.0 1.0; setAttr -l 1 ($t + ".stx"); setAttr -l 1 ($t + ".sty"); setAttr -l 1 ($t + ".stz"); setAttr -l 1 ($t + ".srx"); setAttr -l 1 ($t + ".sry"); setAttr -l 1 ($t + ".srz"); setAttr -l 1 ($t + ".ssx"); setAttr -l 1 ($t + ".ssy"); setAttr -l 1 ($t + ".ssz"); string $ncs[]; string $dts[]; string $tt0 = `curve -os -d 1 -per 1 -k 0 -k 1 -k 2 -k 3 -p -0 -0 -1 -p 1 -0 1 -p -1 -0 1 -p -0 -0 -1`; string $ss0[] = `listRelatives -f -s -typ "nurbsCurve" $tt0`; string $nc0 = $ss0[0]; $ncs[`size $ncs`] = $nc0; $dts[`size $dts`] = $tt0; addAttr -dt "nurbsCurve" -k 0 -ln "sourceCurve" -sn "sc" $nc0; setAttr ($nc0 + ".sc") -typ "nurbsCurve" 1 3 2 0 3 4 0 1 2 3 4 -0 -0 -1 1 -0 1 -1 -0 1 -0 -0 -1; parent -r -s $ncs $t; string $bss[] = `listRelatives -f -s -typ "nurbsCurve" $t`; for ($i = 0; $i < `size $bss`; $i++) { string $bn = $bss[$i]; rename $bn ($t + "Shape" + ($i + 1)); } if (`size $dts`) delete $dts; select -r $t;}
}

/*-
@returns <>
*/
proc addButtonPressed() {
  // print("addButtonPressed\n"); // debug
  string $nodes[] = `ls -l -sl -tr`;
  // print("  nodes:{\n    " + stringArrayToString($nodes, ",\n    ") + "\n  }\n"); // debug
  if (!`size $nodes`) return;

  string $curveName = makeCurveName("");
  // print ("  curveName:" + $curveName + "\n"); // debug
  if (!`size $curveName`) return;

  if (addCurve($curveName, $nodes)) updateCurveList("last");
}

/*-
@returns <>
*/
proc renameButtonPressed() {
  // print("renameButtonPressed\n"); // debug
  int $index = getCurveListSelectedIndex();
  // print("  index:" + $index + "\n"); // debug

  string $curveName = getCurveNameByIndex($index);
  // print ("  curveName:\"" + $curveName + "\"\n"); // debug
  if (!`size $curveName`) return;

  $curveName = makeCurveName($curveName);
  // print ("  curveName:" + $curveName + "\n"); // debug
  if (!`size $curveName`) return;

  if (renameCurve($index, $curveName)) updateCurveList("keepIndex");
}

/*-
@returns <>
*/
proc createButtonPressed() {
  // print("createButtonPressed\n"); // debug
  int $index = getCurveListSelectedIndex();
  // print("  index:" + $index + "\n"); // debug
  string $curveName = getCurveNameByIndex($index);
  // print ("  curveName:" + $curveName + "\n"); // debug
  if (!`size $curveName`) return;
  string $n = createCurve($curveName);
  if (`objExists $n`) select -r $n;
}

/*-
@returns <>
*/
proc unlockButtonPressed() {
  // print("unlockButtonPressed\n"); // debug
  string $nodes[] = `ls -l -sl -tr`;
  // print("  nodes:{\n    " + stringArrayToString($nodes, ",\n    ") + "\n  }\n"); // debug
  if (!`size $nodes`) return;
  lockCurve($nodes, false);
}

/*-
@returns <>
*/
proc lockButtonPressed() {
  // print("lockButtonPressed\n"); // debug
  string $nodes[] = `ls -l -sl -tr`;
  // print("  nodes:{\n    " + stringArrayToString($nodes, ",\n    ") + "\n  }\n"); // debug
  if (!`size $nodes`) return;
  lockCurve($nodes, true);
}

/*-
@returns <>
*/
proc replaceButtonPressed() {
  // print("replaceButtonPressed\n"); // debug
  string $nodes[] = `ls -l -sl -tr`;
  // print("  nodes:{\n    " + stringArrayToString($nodes, ",\n    ") + "\n  }\n"); // debug
  if (!`size $nodes`) return;
  replaceCurves($nodes);
}

/*-
@returns <>
*/
proc curveListDoubleClicked() {
  // print("curveListDoubleClicked\n"); // debug
  createButtonPressed();
}

/*-
@returns <>
*/
proc deleteButtonPressed() {
  // print("deleteButtonPressed\n"); // debug
  int $index = getCurveListSelectedIndex();
  // print("  index:" + $index + "\n"); // debug
  if ($index < 0) return;

  string $result = `confirmDialog
      -b "OK" -db "OK"
      -b "Cancel"-cb "Cancel"
      -m "Are you sure?\n\nDeleted curves are moved to nkCurveDepotCurves/trash."
      -t "Delete Curve"`;
  if ($result != "OK") return;

  if (deleteCurve($index)) updateCurveList("keepIndex");
}

/*-
@returns <>
*/
proc moveUpButtonPressed() {
  // print("moveUpButtonPressed\n"); // debug
  int $index = getCurveListSelectedIndex();
  // print("  index:" + $index + "\n"); // debug
  if (movePrevCurve($index)) updateCurveList("prev");
}

/*-
@returns <>
*/
proc moveDownButtonPressed() {
  // print("moveDownButtonPressed\n"); // debug
  int $index = getCurveListSelectedIndex();
  // print("  index:" + $index + "\n"); // debug
  if (moveNextCurve($index)) updateCurveList("next");
}

/*-
@returns <>
*/
proc sortButtonPressed() {
  // print("sortButtonPressed\n"); // debug
  if (sortCurveOrder()) updateCurveList("keepItem");
}

// -----------------------------------------------------------------------------
// ウィンドウ定義
// -----------------------------------------------------------------------------
/*-
@returns <>
*/
proc buildMainWindow() {
  // print("buildMainWindow\n"); // debug
  windowClose("nkCurveDepotWindow");

  string $nkCurveDepotWindow = `window
      -mxb false
      -mnb false
      -s true
      -t "nkCurveDepot"
      "nkCurveDepotWindow"`;
    string $outerForm = `formLayout "outerForm"`;
      string $menuBar = `menuBarLayout
          // -bgc 0.25 0.5 0.25
          "menuBar"`;
        string $fileMenu = `menu
            -l "File"
            "fileMenu"`;
          string $resetWindowMenuItem = `menuItem
              -l "Reset Window"
              "resetWindowMenuItem"`;
          menuItem -d true;
          string $quitMenuItem = `menuItem
              -l "Quit"
              "quitMenuItem"`;
        string $helpMenu = `menu
            -hm true
            -l "Help"
            "helpMenu"`;
          string $aboutMenuItem = `menuItem
              -l "About nkCurveDepot"
              "aboutMenuItem"`;
      setParent ..;

      // string $column = `columnLayout -adj true -rs 3 "column"`;
      //   string $curve1Button = `button -l "Circle" "curve1Button"`;
      //   string $curve2Button = `button -l "Directional Circle" "curve2Button"`;
      //   string $curve3Button = `button -l "Square" "curve3Button"`;
      //   string $curve4Button = `button -l "Directional Square" "curve4Button"`;
      //   string $curve5Button = `button -l "Half Square" "curve5Button"`;
      //   string $curve6Button = `button -l "Octahedron" "curve6Button"`;
      //   string $curve7Button = `button -l "Cube" "curve7Button"`;
      //   string $curve8Button = `button -l "Cylinder" "curve8Button"`;
      //   string $curve9Button = `button -l "Half Cylinder" "curve9Button"`;
      //   string $curve10Button = `button -l "Square Pyramid" "curve10Button"`;
      //   string $curve11Button = `button -l "Diamond Pyramid" "curve11Button"`;
      //   string $curve12Button = `button -l "Sphere" "curve12Button"`;
      //   string $curve13Button = `button -l "Diamond" "curve13Button"`;
      //   string $curve14Button = `button -l "Gear" "curve14Button"`;
      //   string $curve15Button = `button -l "Triangle" "curve15Button"`;
      // setParent ..;

      string $topToolRow = `rowLayout
          -adj 10
          // -bgc 0.5 0.25 0.25
          -nc 10
          "topToolRow"`;
        string $addButton = `iconTextButton
            -ann "Add Curve"
            // -bgc 0.25 0.5 0.5
            -i "item_add.png"
            -w 23
            "addButton"`;
        string $renameButton = `iconTextButton
            -ann "Rename Curve"
            // -bgc 0.25 0.5 0.5
            -i "passSetRelationEditor.png"
            -w 23
            "renameButton"`;
        separator -h 24 -st "single" -vis true;
        string $createButton = `iconTextButton
            -ann "Create Curve"
            // -bgc 0.25 0.5 0.5
            -i "createNode.png"
            -w 23
            "createButton"`;
        separator -h 24 -st "single" -vis true;
        string $unlockButton = `iconTextButton
            -ann "Unlock Shape Transform"
            // -bgc 0.25 0.5 0.5
            -i "unlockGeneric.png"
            -w 23
            "unlockButton"`;
        string $lockButton = `iconTextButton
            -ann "Lock Shape Transform"
            // -bgc 0.25 0.5 0.5
            -i "lockGeneric.png"
            -w 23
            "lockButton"`;
        separator -h 24 -st "single" -vis true;
        string $replaceButton = `iconTextButton
            -ann "Replace Curve\n\n1. Select source transform node\n2. Select target transform node"
            // -bgc 0.25 0.5 0.5
            -i "bufferSnap.png"
            -w 23
            "replaceButton"`;
        separator -st "none" -vis false;
      setParent ..;

      string $curveList = `textScrollList
          -ams false
          -ekf false
          -h 31
          "curveList"`;

      string $bottomToolRow = `rowLayout
          -adj 2
          // -bgc 0.5 0.25 0.25
          -nc 5
          "bottomToolRow"`;
        string $deleteButton = `iconTextButton
            -ann "Delete Curve"
            // -bgc 0.25 0.5 0.5
            -i "item_delete.png"
            -w 23
            "deleteButton"`;
        separator -st "none" -vis false;
        string $moveUpButton = `iconTextButton
            -ann "Move Curve Up"
            // -bgc 0.25 0.5 0.5
            -i "item_up.png"
            -w 23
            "moveUpButton"`;
        string $moveDownButton = `iconTextButton
            -ann "Move Curve Down"
            // -bgc 0.25 0.5 0.5
            -i "item_down.png"
            -w 23
            "moveDownButton"`;
        string $sortButton = `iconTextButton
            -ann "Sort by ascending order"
            // -bgc 0.25 0.5 0.5
            -i "sortName.png"
            -w 23
            "sortButton"`;
      setParent ..;

    setParent ..;

  formLayout -e
      -af $menuBar "top" 0
      -af $menuBar "left" 0
      -af $menuBar "right" 0

      // -ac $column "top" 0 $menuBar
      // -af $column "left" 5
      // -af $column "right" 5
      // -ac $topToolRow "top" 0 $column
      // -af $topToolRow "left" 5
      // -af $topToolRow "right" 5

      -ac $topToolRow "top" 0 $menuBar
      -af $topToolRow "left" 5
      -af $topToolRow "right" 5

      -ac $curveList "top" 5 $topToolRow
      -af $curveList "left" 5
      -af $curveList "right" 5
      -ac $curveList "bottom" 5 $bottomToolRow
      -af $bottomToolRow "left" 5
      -af $bottomToolRow "right" 5
      -af $bottomToolRow "bottom" 5

      $outerForm;

  window -e -cc "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"cc\", \"nkCurveDepotWindow\");" $nkCurveDepotWindow;
  menuItem -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"resetWindowMenuItem\");" $resetWindowMenuItem;
  menuItem -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"quitMenuItem\");" $quitMenuItem;
  menuItem -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"aboutMenuItem\");" $aboutMenuItem;

  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve1Button\");" $curve1Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve2Button\");" $curve2Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve3Button\");" $curve3Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve4Button\");" $curve4Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve5Button\");" $curve5Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve6Button\");" $curve6Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve7Button\");" $curve7Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve8Button\");" $curve8Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve9Button\");" $curve9Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve10Button\");" $curve10Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve11Button\");" $curve11Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve12Button\");" $curve12Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve13Button\");" $curve13Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve14Button\");" $curve14Button;
  // button -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"curve15Button\");" $curve15Button;

  iconTextButton -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"addButton\");" $addButton;
  iconTextButton -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"renameButton\");" $renameButton;
  iconTextButton -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"createButton\");" $createButton;
  iconTextButton -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"unlockButton\");" $unlockButton;
  iconTextButton -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"lockButton\");" $lockButton;
  iconTextButton -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"replaceButton\");" $replaceButton;
  iconTextButton -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"deleteButton\");" $deleteButton;
  iconTextButton -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"moveUpButton\");" $moveUpButton;
  iconTextButton -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"moveDownButton\");" $moveDownButton;
  iconTextButton -e -c "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"c\", \"sortButton\");" $sortButton;

  textScrollList -e -dcc "nkCurveDepotEventController(\"nkCurveDepotWindow\", \"dcc\", \"curveList\");" $curveList;

  // print("  " + $nkCurveDepotWindow + "\n"); // debug
  // print("  " + $outerForm + "\n"); // debug
  // print("  " + $menuBar + "\n"); // debug
  // print("  " + $fileMenu + "\n"); // debug
  // print("  " + $resetWindowMenuItem + "\n"); // debug
  // print("  " + $quitMenuItem + "\n"); // debug
  // print("  " + $helpMenu + "\n"); // debug
  // print("  " + $aboutMenuItem + "\n"); // debug

  // print("  " + $column + "\n"); // debug
  // print("  " + $curve1Button + "\n"); // debug
  // print("  " + $curve2Button + "\n"); // debug
  // print("  " + $curve3Button + "\n"); // debug
  // print("  " + $curve4Button + "\n"); // debug
  // print("  " + $curve5Button + "\n"); // debug
  // print("  " + $curve6Button + "\n"); // debug
  // print("  " + $curve7Button + "\n"); // debug
  // print("  " + $curve8Button + "\n"); // debug
  // print("  " + $curve9Button + "\n"); // debug
  // print("  " + $curve10Button + "\n"); // debug
  // print("  " + $curve11Button + "\n"); // debug
  // print("  " + $curve12Button + "\n"); // debug
  // print("  " + $curve13Button + "\n"); // debug
  // print("  " + $curve14Button + "\n"); // debug
  // print("  " + $curve15Button + "\n"); // debug

  // print("  " + $topToolRow + "\n"); // debug
  // print("  " + $addButton + "\n"); // debug
  // print("  " + $renameButton + "\n"); // debug
  // print("  " + $createButton + "\n"); // debug
  // print("  " + $unlockButton + "\n"); // debug
  // print("  " + $lockButton + "\n"); // debug
  // print("  " + $replaceButton + "\n"); // debug

  // print("  " + $curveList + "\n"); // debug

  // print("  " + $bottomToolRow + "\n"); // debug
  // print("  " + $deleteButton + "\n"); // debug
  // print("  " + $moveUpButton + "\n"); // debug
  // print("  " + $moveDownButton + "\n"); // debug
  // print("  " + $sortButton + "\n"); // debug

  appendUIControls({
    $nkCurveDepotWindow,
    $curveList
  });

  updateCurveList("none");
  showWindow $nkCurveDepotWindow;
}

// -----------------------------------------------------------------------------
// イベントコントローラ
// -----------------------------------------------------------------------------
/*-
@param $window <string>
@param $event <string>
@param $control <string>
@returns <>
*/
global proc nkCurveDepotEventController(
  string $window,
  string $event,
  string $control
) {
  // print("nkCurveDepotEventController\n"); // debug
  // print("  window :" + $window + "\n"); // debug
  // print("  event  :" + $event + "\n"); // debug
  // print("  control:" + $control + "\n"); // debug
  switch ($window) {
    case "nkCurveDepotWindow":
      switch ($event) {
        case "c":
          switch ($control) {
            case "resetWindowMenuItem": resetWindowMenuItemSelected(); break;
            case "quitMenuItem": quitMenuItemSelected(); break;
            case "aboutMenuItem": aboutMenuItemSelected(); break;

            case "curve1Button": curve1ButtonPressed(); break;
            case "curve2Button": curve2ButtonPressed(); break;
            case "curve3Button": curve3ButtonPressed(); break;
            case "curve4Button": curve4ButtonPressed(); break;
            case "curve5Button": curve5ButtonPressed(); break;
            case "curve6Button": curve6ButtonPressed(); break;
            case "curve7Button": curve7ButtonPressed(); break;
            case "curve8Button": curve8ButtonPressed(); break;
            case "curve9Button": curve9ButtonPressed(); break;
            case "curve10Button": curve10ButtonPressed(); break;
            case "curve11Button": curve11ButtonPressed(); break;
            case "curve12Button": curve12ButtonPressed(); break;
            case "curve13Button": curve13ButtonPressed(); break;
            case "curve14Button": curve14ButtonPressed(); break;
            case "curve15Button": curve15ButtonPressed(); break;

            case "addButton": addButtonPressed(); break;
            case "renameButton": renameButtonPressed(); break;
            case "createButton": createButtonPressed(); break;
            case "unlockButton": unlockButtonPressed(); break;
            case "lockButton": lockButtonPressed(); break;
            case "replaceButton": replaceButtonPressed(); break;
            case "deleteButton": deleteButtonPressed(); break;
            case "moveUpButton": moveUpButtonPressed(); break;
            case "moveDownButton": moveDownButtonPressed(); break;
            case "sortButton": sortButtonPressed(); break;
            default: break;
          }
          break;
        case "dcc":
          switch ($control) {
            case "curveList": curveListDoubleClicked(); break;
            default: break;
          }
          break;
        default: break;
      }
      break;
    default: break;
  }
}

// -----------------------------------------------------------------------------
// ドメインオブザーバ
// -----------------------------------------------------------------------------

// -----------------------------------------------------------------------------
// システムオブザーバ
// -----------------------------------------------------------------------------

// -----------------------------------------------------------------------------
// メイン
// -----------------------------------------------------------------------------
/*-
@returns <string>
*/
global proc string nkCurveDepotVersion() {
  return "1.0.3";
}

/*-
@returns <>
*/
global proc nkCurveDepot() {
  buildMainWindow();
}

/*
eval ("source \"" + `getenv "MAYA_APP_DIR"` + "/dev/nkCurveDepot/nkCurveDepot.mel\"");
nkCurveDepot;
*/

// /////////////////////////////////////////////////////////////////////////////
// テスト
// /////////////////////////////////////////////////////////////////////////////
/*-
@returns <>
@remarks ノード操作。
*/
proc test0() {
  print("test0 start\n");
  string $r;

  // isValidTransform / addTransformAttributes / createTransform
  {
    string $t1 = `createNode -ss "transform"`;
    $r = assertFalse(isValidTransform($t1)); if (`size $r`) warning $r;
    addTransformAttributes($t1);
    $r = assertTrue(isValidTransform($t1)); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0}, `getAttr ($t1 + ".st")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0}, `getAttr ($t1 + ".sr")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({1.0, 1.0, 1.0}, `getAttr ($t1 + ".ss")`, 0.001); if (`size $r`) warning $r;
    string $t2 = createTransform("controller");
    $r = assertTrue(isValidTransform($t2)); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0}, `getAttr ($t2 + ".st")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0}, `getAttr ($t2 + ".sr")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({1.0, 1.0, 1.0}, `getAttr ($t2 + ".ss")`, 0.001); if (`size $r`) warning $r;
    if (`objExists $t1`) delete $t1;
    if (`objExists $t2`) delete $t2;
  }

  // isValidNurbsCurve / addCurveAttribute
  {
    string $t = `curve -d 1 -k 0 -k 1 -p 0 0 0 -p 1 0 0`;
    string $shapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $t`;
    string $nc = $shapeNodes[0];
    $r = assertFalse(isValidNurbsCurve($nc)); if (`size $r`) warning $r;
    addCurveAttribute($nc);
    $r = assertTrue(isValidNurbsCurve($nc)); if (`size $r`) warning $r;
    if (`objExists $t`) delete $t;
  }

  // collectCurveNodes
  {
    string $ncs[];
    string $tx = `curve -d 1 -k 0 -k 1 -p 0 0 0 -p 1 0 0`;
    string $ty = `curve -d 1 -k 0 -k 1 -p 0 0 0 -p 0 1 0`;
    string $tz = `curve -d 1 -k 0 -k 1 -p 0 0 0 -p 0 0 1`;
    string $txShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $tx`;
    string $tyShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $ty`;
    string $tzShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $tz`;
    string $ncx = $txShapeNodes[0];
    string $ncy = $tyShapeNodes[0];
    string $ncz = $tzShapeNodes[0];
    $ncs[`size $ncs`] = $ncx;
    $ncs[`size $ncs`] = $ncy;
    $ncs[`size $ncs`] = $ncz;
    string $t = `createNode -ss "transform"`;
    parent -r -s $ncs $t;

    string $tnc1 = `substitute $tx $ncx $t`;
    string $tnc2 = `substitute $ty $ncy $t`;
    string $tnc3 = `substitute $tz $ncz $t`;
    $r = assertFalse(isValidNurbsCurve($tnc1)); if (`size $r`) warning $r;
    $r = assertFalse(isValidNurbsCurve($tnc2)); if (`size $r`) warning $r;
    $r = assertFalse(isValidNurbsCurve($tnc3)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({}, collectCurveNodes($t, true)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({$tnc1, $tnc2, $tnc3}, collectCurveNodes($t, false)); if (`size $r`) warning $r;

    addCurveAttribute($tnc1);
    addCurveAttribute($tnc2);
    addCurveAttribute($tnc3);
    $r = assertTrue(isValidNurbsCurve($tnc1)); if (`size $r`) warning $r;
    $r = assertTrue(isValidNurbsCurve($tnc2)); if (`size $r`) warning $r;
    $r = assertTrue(isValidNurbsCurve($tnc3)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({$tnc1, $tnc2, $tnc3}, collectCurveNodes($t, true)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({$tnc1, $tnc2, $tnc3}, collectCurveNodes($t, false)); if (`size $r`) warning $r;

    if (`objExists $tx`) delete $tx;
    if (`objExists $ty`) delete $ty;
    if (`objExists $tz`) delete $tz;
    if (`objExists $t`) delete $t;
  }

  // isEditMode
  {
    string $t = createTransform("controller");
    $r = assertFalse(isEditMode($t)); if (`size $r`) warning $r;

    string $m = `createNode "composeMatrix" -ss`;
    connectAttr -f ($t + ".st") ($m + ".it");
    connectAttr -f ($t + ".sr") ($m + ".ir");
    connectAttr -f ($t + ".ss") ($m + ".is");
    $r = assertTrue(isEditMode($t)); if (`size $r`) warning $r;

    if (`objExists $m`) delete $m;
    if (`objExists $t`) delete $t;
  }

  // setTransformAttributeLock / setTransformAttributeCB / setTransformAttributeState
  {
    string $t = createTransform("controller");
    string $stx = $t + ".stx";
    string $sty = $t + ".sty";
    string $stz = $t + ".stz";
    string $srx = $t + ".srx";
    string $sry = $t + ".sry";
    string $srz = $t + ".srz";
    string $ssx = $t + ".ssx";
    string $ssy = $t + ".ssy";
    string $ssz = $t + ".ssz";

    $r = assertFalse(`getAttr -l $stx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $sty`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $stz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $srx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $sry`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $srz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $ssx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $ssy`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $ssz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $stx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $sty`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $stz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $srx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $sry`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $srz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssy`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssz`); if (`size $r`) warning $r;

    setTransformAttributeLock($t, true);
    $r = assertTrue(`getAttr -l $stx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $sty`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $stz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $srx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $sry`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $srz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $ssx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $ssy`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $ssz`); if (`size $r`) warning $r;
    setTransformAttributeLock($t, false);
    $r = assertFalse(`getAttr -l $stx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $sty`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $stz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $srx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $sry`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $srz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $ssx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $ssy`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $ssz`); if (`size $r`) warning $r;

    setTransformAttributeCB($t, true);
    $r = assertTrue(`getAttr -cb $stx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $sty`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $stz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $srx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $sry`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $srz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $ssx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $ssy`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $ssz`); if (`size $r`) warning $r;
    setTransformAttributeCB($t, false);
    $r = assertFalse(`getAttr -cb $stx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $sty`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $stz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $srx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $sry`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $srz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssy`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssz`); if (`size $r`) warning $r;

    setTransformAttributeState($t, true);
    $r = assertFalse(`getAttr -l $stx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $sty`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $stz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $srx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $sry`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $srz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $ssx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $ssy`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -l $ssz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $stx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $sty`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $stz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $srx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $sry`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $srz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $ssx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $ssy`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -cb $ssz`); if (`size $r`) warning $r;

    setTransformAttributeState($t, false);
    $r = assertTrue(`getAttr -l $stx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $sty`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $stz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $srx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $sry`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $srz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $ssx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $ssy`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $ssz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $stx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $sty`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $stz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $srx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $sry`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $srz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssy`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssz`); if (`size $r`) warning $r;

    if (`objExists $t`) delete $t;
  }

  // renameCurveNodes
  {
    string $tx = `curve -d 1 -k 0 -k 1 -p 0 0 0 -p 1 0 0`;
    string $ty = `curve -d 1 -k 0 -k 1 -p 0 0 0 -p 0 1 0`;
    string $tz = `curve -d 1 -k 0 -k 1 -p 0 0 0 -p 0 0 1`;
    string $txShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $tx`;
    string $tyShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $ty`;
    string $tzShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $tz`;
    string $ncs[] = {$txShapeNodes[0], $tyShapeNodes[0], $tzShapeNodes[0]};
    string $p = longNameOf(`createNode -ss "transform"`);
    string $t = longNameOf(`createNode -p $p -ss "transform"`);
    string $newShapeNodes[] = {"Shape1", "Shape2", "Shape3"};
    stringArrayAddPrefix($newShapeNodes, shortNameOf($t));

    $r = assertTrue(`objExists $ncs[0]`); if (`size $r`) warning $r;
    $r = assertTrue(`objExists $ncs[1]`); if (`size $r`) warning $r;
    $r = assertTrue(`objExists $ncs[2]`); if (`size $r`) warning $r;

    parent -r -s $ncs $t;
    $r = assertFalse(`objExists $ncs[0]`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $ncs[1]`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $ncs[2]`); if (`size $r`) warning $r;

    $ncs = renameCurveNodes($t);
    $r = assertStringArrayEqual($newShapeNodes, $ncs); if (`size $r`) warning $r;
    $r = assertTrue(`objExists $ncs[0]`); if (`size $r`) warning $r;
    $r = assertTrue(`objExists $ncs[1]`); if (`size $r`) warning $r;
    $r = assertTrue(`objExists $ncs[2]`); if (`size $r`) warning $r;

    if (`objExists $tx`) delete $tx;
    if (`objExists $ty`) delete $ty;
    if (`objExists $tz`) delete $tz;
    if (`objExists $t`) delete $t;
    if (`objExists $p`) delete $p;
  }

  // deleteNodes
  {
    string $t1 = `createNode -ss "transform"`;
    string $t2 = `createNode -ss "transform"`;
    string $t3 = `createNode -ss "transform"`;
    deleteNodes({$t1, $t2, $t3});
    $r = assertFalse(`objExists $t1`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $t2`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $t3`); if (`size $r`) warning $r;
  }

  print("test0 end\n");
}

/*-
@returns <>
@remarks カーブ定義。
*/
proc test1() {
  print("test1 start\n");
  string $r;

  // serializeCurve
  {
    string $t1 = `curve -d 1 -os -per 0 -k 0 -k 1 -p 0 0 0 -p 1 0 0`;
    string $shapeNodes1[] = `listRelatives -f -s -typ "nurbsCurve" $t1`;
    string $nc1 = $shapeNodes1[0];
    $r = assertStringEqual("", serializeCurve($t1)); if (`size $r`) warning $r;
    $r = assertStringEqual("1,1,0,0,3/0,1/0,0,0;1,0,0", serializeCurve($nc1)); if (`size $r`) warning $r;

    string $t2 = `curve -d 1 -os -per 1 -k 0 -k 1 -k 2 -k 3 -p 0 0 0 -p 1 0 0 -p 1 0 1 -p 0 0 0`;
    string $shapeNodes2[] = `listRelatives -f -s -typ "nurbsCurve" $t2`;
    string $nc2 = $shapeNodes2[0];
    $r = assertStringEqual("", serializeCurve($t2)); if (`size $r`) warning $r;
    $r = assertStringEqual("1,3,2,0,3/0,1,2,3/0,0,0;1,0,0;1,0,1;0,0,0", serializeCurve($nc2)); if (`size $r`) warning $r;

    if (`objExists $t1`) delete $t1;
    if (`objExists $t2`) delete $t2;
  }

  // bundleCurves
  {
    string $tx = `curve -d 1 -os -per 0 -k 0 -k 1 -p 0 0 0 -p 1 0 0`;
    string $ty = `curve -d 1 -os -per 0 -k 0 -k 1 -p 0 0 0 -p 0 1 0`;
    string $tz = `curve -d 1 -os -per 0 -k 0 -k 1 -p 0 0 0 -p 0 0 1`;
    string $txShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $tx`;
    string $tyShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $ty`;
    string $tzShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $tz`;
    string $ncx = $txShapeNodes[0];
    string $ncy = $tyShapeNodes[0];
    string $ncz = $tzShapeNodes[0];

    $r = assertStringEqual("", bundleCurves({})); if (`size $r`) warning $r;
    $r = assertStringEqual("", bundleCurves({$ncx})); if (`size $r`) warning $r;
    $r = assertStringEqual("1,1,0,0,3/0,1/0,0,0;1,0,0\n", bundleCurves({$tx})); if (`size $r`) warning $r;
    $r = assertStringEqual("", bundleCurves({$ncy})); if (`size $r`) warning $r;
    $r = assertStringEqual("1,1,0,0,3/0,1/0,0,0;0,1,0\n", bundleCurves({$ty})); if (`size $r`) warning $r;
    $r = assertStringEqual("", bundleCurves({$ncz})); if (`size $r`) warning $r;
    $r = assertStringEqual("1,1,0,0,3/0,1/0,0,0;0,0,1\n", bundleCurves({$tz})); if (`size $r`) warning $r;
    $r = assertStringEqual("", bundleCurves({$ncx, $ncy, $ncz})); if (`size $r`) warning $r;
    $r = assertStringEqual("1,1,0,0,3/0,1/0,0,0;1,0,0\n1,1,0,0,3/0,1/0,0,0;0,1,0\n1,1,0,0,3/0,1/0,0,0;0,0,1\n", bundleCurves({$tx, $ty, $tz})); if (`size $r`) warning $r;

    if (`objExists $tx`) delete $tx;
    if (`objExists $ty`) delete $ty;
    if (`objExists $tz`) delete $tz;
  }

  // deserializeCurve
  {
    string $curveText1 = "1,1,0,0,3/0,1/0,0,0;1,0,0";

    $r = assertStringEqual("", deserializeCurve("")); if (`size $r`) warning $r;
    $r = assertStringEqual("", deserializeCurve("1")); if (`size $r`) warning $r;
    $r = assertStringEqual("", deserializeCurve("1/2")); if (`size $r`) warning $r;
    $r = assertStringEqual("", deserializeCurve("1/2/3")); if (`size $r`) warning $r;
    $r = assertStringEqual("", deserializeCurve("1,1/2/3")); if (`size $r`) warning $r;
    $r = assertStringEqual("", deserializeCurve("1,1,0/2/3")); if (`size $r`) warning $r;
    $r = assertStringEqual("", deserializeCurve("1,1,1,1/2/3")); if (`size $r`) warning $r;
    $r = assertStringEqual("", deserializeCurve("1,1,1,1,1/2/3")); if (`size $r`) warning $r;
    $r = assertStringEqual("", deserializeCurve("1,1,1,1,1/2/3,3;3,3")); if (`size $r`) warning $r;

    string $t1 = deserializeCurve($curveText1);
    $r = assertTrue(`objExists $t1`); if (`size $r`) warning $r;
    $r = assertStringEqual("transform", `nodeType $t1`); if (`size $r`) warning $r;
    string $shapeNodes1[] = `listRelatives -f -s -typ "nurbsCurve" $t1`;
    $r = assertIntEqual(1, `size $shapeNodes1`); if (`size $r`) warning $r;
    string $nc1 = $shapeNodes1[0];
    $r = assertTrue(`objExists $nc1`); if (`size $r`) warning $r;
    $r = assertStringEqual("nurbsCurve", `nodeType $nc1`); if (`size $r`) warning $r;
    $r = assertTrue(`attributeQuery -n $nc1 -ex "sourceCurve"`); if (`size $r`) warning $r;
    $r = assertStringEqual("nurbsCurve", `getAttr -typ ($nc1 + ".sourceCurve")`); if (`size $r`) warning $r;
    $r = assertIntEqual(1, `getAttr ($nc1 + ".d")`); if (`size $r`) warning $r;
    $r = assertIntEqual(1, `getAttr ($nc1 + ".s")`); if (`size $r`) warning $r;
    $r = assertIntEqual(0, `getAttr ($nc1 + ".f")`); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0, 1.0, 0.0, 0.0}, `getAttr ($nc1 + ".cp[*]")`, 0.001); if (`size $r`) warning $r;

    // 次数の異なるカーブをアタッチした時にできるClosedなカーブ
    string $curveText2 = "2,3,1,0,3/0,0,1,1,2,2/0,0,-1;-1,0,0;0,0,1;0,0,0;0,0,-1";

    string $t2 = deserializeCurve($curveText2);
    $r = assertTrue(`objExists $t2`); if (`size $r`) warning $r;
    $r = assertStringEqual("transform", `nodeType $t2`); if (`size $r`) warning $r;
    string $shapeNodes2[] = `listRelatives -f -s -typ "nurbsCurve" $t2`;
    $r = assertIntEqual(1, `size $shapeNodes2`); if (`size $r`) warning $r;
    string $nc2 = $shapeNodes2[0];
    $r = assertTrue(`objExists $nc2`); if (`size $r`) warning $r;
    $r = assertStringEqual("nurbsCurve", `nodeType $nc2`); if (`size $r`) warning $r;
    $r = assertTrue(`attributeQuery -n $nc2 -ex "sourceCurve"`); if (`size $r`) warning $r;
    $r = assertStringEqual("nurbsCurve", `getAttr -typ ($nc2 + ".sourceCurve")`); if (`size $r`) warning $r;
    $r = assertIntEqual(2, `getAttr ($nc2 + ".d")`); if (`size $r`) warning $r;
    $r = assertIntEqual(3, `getAttr ($nc2 + ".s")`); if (`size $r`) warning $r;
    $r = assertIntEqual(0, `getAttr ($nc2 + ".f")`); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, -1.0, -1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.0}, `getAttr ($nc2 + ".cp[*]")`, 0.001); if (`size $r`) warning $r;

    if (`objExists $t1`) delete $t1;
    if (`objExists $t2`) delete $t2;
  }

  print("test1 end\n");
}

/*-
@returns <>
@remarks カーブリスト。
*/
proc test2() {
  string $curveDirname = `getenv "MAYA_APP_DIR"` + "/dev/nkCurveDepot/nkCurveDepotCurves";
  string $trashDirname = $curveDirname + "/trash";
  string $curveOrderFilename = $curveDirname + "/order.txt";

  int $existsOrderFile = existsFilename($curveOrderFilename);
  string $lastOrderContent;
  if ($existsOrderFile) {
    $lastOrderContent = readAllText($curveOrderFilename, "");
    deleteFile($curveOrderFilename);
  }

  print("test2 start\n");
  string $r;

  // getCurveDirname
  $r = assertStringEqual($curveDirname, getCurveDirname()); if (`size $r`) warning $r;

  // getCurveDirname
  $r = assertStringEqual($trashDirname, getTrashDirname()); if (`size $r`) warning $r;

  // getCurveOrderFilename
  $r = assertStringEqual($curveOrderFilename, getCurveOrderFilename()); if (`size $r`) warning $r;

  // readCurveOrder
  {
    $r = assertStringArrayEqual({}, readCurveOrder()); if (`size $r`) warning $r;
    writeAllText($curveOrderFilename, "", "");
    $r = assertStringArrayEqual({}, readCurveOrder()); if (`size $r`) warning $r;
    writeAllText($curveOrderFilename, "", "a\nb\n");
    $r = assertStringArrayEqual({"a", "b"}, readCurveOrder()); if (`size $r`) warning $r;
    if (existsFilename($curveOrderFilename)) deleteFile($curveOrderFilename);
  }

  // writeCurveOrder
  {
    $r = assertTrue(writeCurveOrder({})); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($curveOrderFilename)); if (`size $r`) warning $r;
    $r = assertTrue(writeCurveOrder({"a", "b"})); if (`size $r`) warning $r;
    $r = assertStringEqual("a\nb\n", readAllText($curveOrderFilename, "")); if (`size $r`) warning $r;
    if (existsFilename($curveOrderFilename)) deleteFile($curveOrderFilename);
  }

  // sortCurveOrder
  {
    $r = assertFalse(existsFilename($curveOrderFilename)); if (`size $r`) warning $r;
    $r = assertFalse(sortCurveOrder()); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($curveOrderFilename)); if (`size $r`) warning $r;
    $r = assertTrue(writeAllText($curveOrderFilename, "", "c\na\nd\nb\n")); if (`size $r`) warning $r;
    $r = assertTrue(sortCurveOrder()); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"a", "b", "c", "d"}, readCurveOrder()); if (`size $r`) warning $r;
    if (existsFilename($curveOrderFilename)) deleteFile($curveOrderFilename);
  }

  // getCurveNameByIndex
  {
    $r = assertTrue(writeAllText($curveOrderFilename, "", "a\nb\nc\n")); if (`size $r`) warning $r;
    $r = assertStringEqual("", getCurveNameByIndex(-1)); if (`size $r`) warning $r;
    $r = assertStringEqual("", getCurveNameByIndex(3)); if (`size $r`) warning $r;
    $r = assertStringEqual("a", getCurveNameByIndex(0)); if (`size $r`) warning $r;
    $r = assertStringEqual("b", getCurveNameByIndex(1)); if (`size $r`) warning $r;
    $r = assertStringEqual("c", getCurveNameByIndex(2)); if (`size $r`) warning $r;
    if (existsFilename($curveOrderFilename)) deleteFile($curveOrderFilename);
  }

  // escapeCurveName
  $r = assertStringEqual("", escapeCurveName("")); if (`size $r`) warning $r;
  $r = assertStringEqual(" ", escapeCurveName(" ")); if (`size $r`) warning $r;
  $r = assertStringEqual("abcdefghijklmnopqrstuvwxyz", escapeCurveName("abcdefghijklmnopqrstuvwxyz")); if (`size $r`) warning $r;
  $r = assertStringEqual("ABCDEFGHIJKLMNOPQRSTUVWXYZ", escapeCurveName("ABCDEFGHIJKLMNOPQRSTUVWXYZ")); if (`size $r`) warning $r;
  $r = assertStringEqual("0123456789", escapeCurveName("0123456789")); if (`size $r`) warning $r;
  $r = assertStringEqual("_-,;!.'()[]{}@&#%`^+=~$", escapeCurveName("_-,;!.'()[]{}@&#%`^+=~$")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a:b")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a?b")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a\"b")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a*b")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a/b")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a\\b")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a<b")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a>b")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a|b")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a\nb")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a\rb")); if (`size $r`) warning $r;
  $r = assertStringEqual("a b", escapeCurveName("a\tb")); if (`size $r`) warning $r;

  // makeCurveFilename
  $r = assertStringEqual($curveDirname + "/a.curvedepot", makeCurveFilename("a")); if (`size $r`) warning $r;

  // makeTrashFilename
  $r = assertStringEqual($trashDirname + "/a.curvedepot", makeTrashFilename("a")); if (`size $r`) warning $r;

  // addCurve
  {
    string $t = `createNode -ss "transform"`;
    string $tx = `curve -d 1 -k 0 -k 1 -p 0 0 0 -p 1 0 0`;
    string $ty = `curve -d 1 -k 0 -k 1 -p 0 0 0 -p 0 1 0`;
    string $tz = `curve -d 1 -k 0 -k 1 -p 0 0 0 -p 0 0 1`;
    string $txShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $tx`;
    string $tyShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $ty`;
    string $tzShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $tz`;
    string $ncx = $txShapeNodes[0];
    string $ncy = $tyShapeNodes[0];
    string $ncz = $tzShapeNodes[0];

    string $xCurveFilename = $curveDirname + "/x.curvedepot";
    string $yCurveFilename = $curveDirname + "/y.curvedepot";
    string $zCurveFilename = $curveDirname + "/z.curvedepot";
    string $xyzCurveFilename = $curveDirname + "/x y z.curvedepot";

    $r = assertFalse(existsFilename($curveOrderFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($xCurveFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($yCurveFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($zCurveFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($xyzCurveFilename)); if (`size $r`) warning $r;

    $r = assertFalse(addCurve("", {$tx})); if (`size $r`) warning $r;
    $r = assertFalse(addCurve("x", {})); if (`size $r`) warning $r;
    $r = assertFalse(addCurve("x", {$ncx})); if (`size $r`) warning $r;

    $r = assertTrue(addCurve("x", {$tx})); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xCurveFilename)); if (`size $r`) warning $r;
    $r = assertStringEqual("1,1,0,0,3/0,1/0,0,0;1,0,0\n", readAllText($xCurveFilename, "")); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertFalse(addCurve("x", {$tx})); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertTrue(addCurve("y", {$ty})); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($yCurveFilename)); if (`size $r`) warning $r;
    $r = assertStringEqual("1,1,0,0,3/0,1/0,0,0;0,1,0\n", readAllText($yCurveFilename, "")); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x", "y"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertTrue(addCurve("z", {$tz})); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($zCurveFilename)); if (`size $r`) warning $r;
    $r = assertStringEqual("1,1,0,0,3/0,1/0,0,0;0,0,1\n", readAllText($zCurveFilename, "")); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x", "y", "z"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertTrue(addCurve("x<y>z", {$tx, $ty, $tz})); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xyzCurveFilename)); if (`size $r`) warning $r;
    $r = assertStringEqual("1,1,0,0,3/0,1/0,0,0;1,0,0\n1,1,0,0,3/0,1/0,0,0;0,1,0\n1,1,0,0,3/0,1/0,0,0;0,0,1\n", readAllText($xyzCurveFilename, "")); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x", "y", "z", "x y z"}, readCurveOrder()); if (`size $r`) warning $r;

    if (existsFilename($curveOrderFilename)) deleteFile($curveOrderFilename);
    if (existsFilename($xCurveFilename)) deleteFile($xCurveFilename);
    if (existsFilename($yCurveFilename)) deleteFile($yCurveFilename);
    if (existsFilename($zCurveFilename)) deleteFile($zCurveFilename);
    if (existsFilename($xyzCurveFilename)) deleteFile($xyzCurveFilename);
    if (`objExists $t`) delete $t;
    if (`objExists $tx`) delete $tx;
    if (`objExists $ty`) delete $ty;
    if (`objExists $tz`) delete $tz;
  }

  // deleteCurve
  {
    string $xCurveFilename = $curveDirname + "/x.curvedepot";
    string $yCurveFilename = $curveDirname + "/y.curvedepot";
    string $zCurveFilename = $curveDirname + "/z.curvedepot";
    string $xTrashFilename = $trashDirname + "/x.curvedepot";
    string $yTrashFilename = $trashDirname + "/y.curvedepot";
    string $zTrashFilename = $trashDirname + "/z.curvedepot";

    $r = assertTrue(writeAllText($curveOrderFilename, "", "x\ny\nz\n")); if (`size $r`) warning $r;
    $r = assertTrue(writeAllText($xCurveFilename, "", "")); if (`size $r`) warning $r;
    $r = assertTrue(writeAllText($yCurveFilename, "", "")); if (`size $r`) warning $r;
    $r = assertTrue(writeAllText($zCurveFilename, "", "")); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($curveOrderFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($yCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($zCurveFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($xTrashFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($yTrashFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($zTrashFilename)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x", "y", "z"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertFalse(deleteCurve(-1)); if (`size $r`) warning $r;
    $r = assertFalse(deleteCurve(3)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($yCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($zCurveFilename)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x", "y", "z"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertTrue(deleteCurve(1)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xCurveFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($yCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($zCurveFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($xTrashFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($yTrashFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($zTrashFilename)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x", "z"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertTrue(deleteCurve(0)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($xCurveFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($yCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($zCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xTrashFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($yTrashFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($zTrashFilename)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"z"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertTrue(deleteCurve(0)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($xCurveFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($yCurveFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($zCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xTrashFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($yTrashFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($zTrashFilename)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({}, readCurveOrder()); if (`size $r`) warning $r;
    $r = assertStringEqual("", readAllText($curveOrderFilename, "")); if (`size $r`) warning $r;

    if (existsFilename($xTrashFilename)) deleteFile($xTrashFilename);
    if (existsFilename($yTrashFilename)) deleteFile($yTrashFilename);
    if (existsFilename($zTrashFilename)) deleteFile($zTrashFilename);
    if (existsFilename($curveOrderFilename)) deleteFile($curveOrderFilename);
  }

  // renameCurve
  {
    string $xCurveFilename = $curveDirname + "/x.curvedepot";
    string $yCurveFilename = $curveDirname + "/y.curvedepot";
    string $zCurveFilename = $curveDirname + "/z.curvedepot";
    string $xyzCurveFilename = $curveDirname + "/x y z.curvedepot";

    $r = assertTrue(writeAllText($curveOrderFilename, "", "x\ny\nz\n")); if (`size $r`) warning $r;
    $r = assertTrue(writeAllText($xCurveFilename, "", "")); if (`size $r`) warning $r;
    $r = assertTrue(writeAllText($yCurveFilename, "", "")); if (`size $r`) warning $r;
    $r = assertTrue(writeAllText($zCurveFilename, "", "")); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($curveOrderFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($yCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($zCurveFilename)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x", "y", "z"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertFalse(renameCurve(1, "")); if (`size $r`) warning $r;
    $r = assertFalse(renameCurve(-1, "x<y>z")); if (`size $r`) warning $r;
    $r = assertFalse(renameCurve(3, "x<y>z")); if (`size $r`) warning $r;
    $r = assertTrue(renameCurve(1, "x<y>z")); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xCurveFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($yCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($zCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xyzCurveFilename)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x", "x y z", "z"}, readCurveOrder()); if (`size $r`) warning $r;

    if (existsFilename($xCurveFilename)) deleteFile($xCurveFilename);
    if (existsFilename($yCurveFilename)) deleteFile($yCurveFilename);
    if (existsFilename($zCurveFilename)) deleteFile($zCurveFilename);
    if (existsFilename($xyzCurveFilename)) deleteFile($xyzCurveFilename);
    if (existsFilename($curveOrderFilename)) deleteFile($curveOrderFilename);
  }

  // movePrevCurve / moveNextCurve
  {
    $r = assertTrue(writeAllText($curveOrderFilename, "", "x\ny\nz\n")); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($curveOrderFilename)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"x", "y", "z"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertFalse(movePrevCurve(-1)); if (`size $r`) warning $r;
    $r = assertFalse(movePrevCurve(3)); if (`size $r`) warning $r;
    $r = assertFalse(movePrevCurve(0)); if (`size $r`) warning $r;
    $r = assertTrue(movePrevCurve(1)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"y", "x", "z"}, readCurveOrder()); if (`size $r`) warning $r;

    $r = assertFalse(moveNextCurve(-1)); if (`size $r`) warning $r;
    $r = assertFalse(moveNextCurve(3)); if (`size $r`) warning $r;
    $r = assertFalse(moveNextCurve(2)); if (`size $r`) warning $r;
    $r = assertTrue(moveNextCurve(1)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"y", "z", "x"}, readCurveOrder()); if (`size $r`) warning $r;

    if (existsFilename($curveOrderFilename)) deleteFile($curveOrderFilename);
  }

  print("test2 end\n");

  if ($existsOrderFile) {
    writeAllText($curveOrderFilename, "", $lastOrderContent);
  }
}

/*-
@returns <>
@remarks カーブ操作。
*/
proc test3() {
  string $curveDirname = `getenv "MAYA_APP_DIR"` + "/dev/nkCurveDepot/nkCurveDepotCurves";
  string $curveOrderFilename = $curveDirname + "/order.txt";

  int $existsOrderFile = existsFilename($curveOrderFilename);
  string $lastOrderContent;
  if ($existsOrderFile) {
    $lastOrderContent = readAllText($curveOrderFilename, "");
    deleteFile($curveOrderFilename);
  }

  print("test3 start\n");
  string $r;

  // createCurve
  {
    string $xyzCurveFilename = $curveDirname + "/xyz.curvedepot";

    $r = assertFalse(existsFilename($curveOrderFilename)); if (`size $r`) warning $r;
    $r = assertFalse(existsFilename($xyzCurveFilename)); if (`size $r`) warning $r;
    $r = assertTrue(writeAllText($curveOrderFilename, "", "xyz\n")); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($curveOrderFilename)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({"xyz"}, readCurveOrder()); if (`size $r`) warning $r;
    $r = assertTrue(writeAllText($xyzCurveFilename, "", "1,1,0,0,3/0,1/0,0,0;1,0,0\n1,1,0,0,3/0,1/0,0,0;0,1,0\n1,1,0,0,3/0,1/0,0,0;0,0,1\n")); if (`size $r`) warning $r;
    $r = assertTrue(existsFilename($xyzCurveFilename)); if (`size $r`) warning $r;
    $r = assertStringEqual("1,1,0,0,3/0,1/0,0,0;1,0,0\n1,1,0,0,3/0,1/0,0,0;0,1,0\n1,1,0,0,3/0,1/0,0,0;0,0,1\n", readAllText($xyzCurveFilename, "")); if (`size $r`) warning $r;

    string $t = createCurve("xyz");
    $r = assertTrue(isValidTransform($t)); if (`size $r`) warning $r;
    string $shapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $t`;
    $r = assertIntEqual(3, `size $shapeNodes`); if (`size $r`) warning $r;
    string $ncx = $shapeNodes[0];
    $r = assertTrue(isValidNurbsCurve($ncx)); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0, 1.0, 0.0, 0.0}, `getAttr ($ncx + ".cp[*]")`, 0.001); if (`size $r`) warning $r;
    string $ncy = $shapeNodes[1];
    $r = assertTrue(isValidNurbsCurve($ncy)); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0, 0.0, 1.0, 0.0}, `getAttr ($ncy + ".cp[*]")`, 0.001); if (`size $r`) warning $r;
    string $ncz = $shapeNodes[2];
    $r = assertTrue(isValidNurbsCurve($ncz)); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0, 0.0, 0.0, 1.0}, `getAttr ($ncz + ".cp[*]")`, 0.001); if (`size $r`) warning $r;

    string $stx = $t + ".stx";
    string $sty = $t + ".sty";
    string $stz = $t + ".stz";
    string $srx = $t + ".srx";
    string $sry = $t + ".sry";
    string $srz = $t + ".srz";
    string $ssx = $t + ".ssx";
    string $ssy = $t + ".ssy";
    string $ssz = $t + ".ssz";
    $r = assertTrue(`getAttr -l $stx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $sty`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $stz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $srx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $sry`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $srz`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $ssx`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $ssy`); if (`size $r`) warning $r;
    $r = assertTrue(`getAttr -l $ssz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $stx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $sty`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $stz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $srx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $sry`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $srz`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssx`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssy`); if (`size $r`) warning $r;
    $r = assertFalse(`getAttr -cb $ssz`); if (`size $r`) warning $r;

    if (existsFilename($curveOrderFilename)) deleteFile($curveOrderFilename);
    if (existsFilename($xyzCurveFilename)) deleteFile($xyzCurveFilename);
    if (`objExists $t`) delete $t;
  }

  // buildEditableGraph / removeEditableGraph / lockCurve
  {
    string $t = `curve -d 1 -os -per 0 -k 0 -k 1 -p 0 0 0 -p 1 0 0`;
    addTransformAttributes($t);
    string $shapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $t`;
    string $nc = $shapeNodes[0];
    addCurveAttribute($nc);
    setAttr ($nc + ".sc") -typ "nurbsCurve" 1 1 0 0 3 2 0 1 2 0 0 0 1 0 0;
    $r = assertTrue(isValidTransform($t)); if (`size $r`) warning $r;
    $r = assertTrue(isValidNurbsCurve($nc)); if (`size $r`) warning $r;

    string $nodes[] = buildEditableGraph({$t});
    $r = assertIntEqual(7, `size $nodes`); if (`size $r`) warning $r;
    $r = assertStringEqual("composeMatrix", `nodeType $nodes[0]`); if (`size $r`) warning $r;
    $r = assertStringEqual("colorMath",     `nodeType $nodes[1]`); if (`size $r`) warning $r;
    $r = assertStringEqual("curveInfo",     `nodeType $nodes[2]`); if (`size $r`) warning $r;
    $r = assertStringEqual("vectorProduct", `nodeType $nodes[3]`); if (`size $r`) warning $r;
    $r = assertStringEqual("colorMath",     `nodeType $nodes[4]`); if (`size $r`) warning $r;
    $r = assertStringEqual("vectorProduct", `nodeType $nodes[5]`); if (`size $r`) warning $r;
    $r = assertStringEqual("colorMath",     `nodeType $nodes[6]`); if (`size $r`) warning $r;

    removeEditableGraph({$t});
    $r = assertFalse(`objExists $nodes[0]`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $nodes[1]`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $nodes[2]`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $nodes[3]`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $nodes[4]`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $nodes[5]`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $nodes[6]`); if (`size $r`) warning $r;

    if (`objExists $t`) delete $t;
  }

  // replaceCurves
  {
    string $t1 = `curve -d 1 -os -per 0 -k 0 -k 1 -p 0 0 0 -p 1 0 0`;
    string $t2 = `curve -d 1 -os -per 0 -k 0 -k 1 -p 0 0 0 -p 0 1 0`;
    string $t3 = `curve -d 1 -os -per 0 -k 0 -k 1 -p 0 0 0 -p 0 0 1`;
    string $t1ShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $t1`;
    string $t2ShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $t2`;
    string $t3ShapeNodes[] = `listRelatives -f -s -typ "nurbsCurve" $t3`;
    string $nc1 = $t1ShapeNodes[0];
    string $nc2 = $t2ShapeNodes[0];
    string $nc3 = $t3ShapeNodes[0];
    string $ncs[];

    $r = assertStringArrayEqual({}, replaceCurves({})); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({}, replaceCurves({$t1})); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({}, replaceCurves({$t1, $t2, $t3})); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({}, replaceCurves({$t1, $t2})); if (`size $r`) warning $r;

    addTransformAttributes($t1);
    $r = assertStringArrayEqual({}, replaceCurves({$t1, $nc2})); if (`size $r`) warning $r;
    addCurveAttribute($nc1);
    setAttr ($t1 + ".sr") -typ "double3" 0.0 0.0 90.0;
    setAttr ($t1 + ".ss") -typ "double3" 2.0 1.0 1.0;
    setAttr ($nc1 + ".sc") -typ "nurbsCurve" 1 1 0 0 3 2 0 1 2 0 0 0 1 0 0;
    $r = assertTrue(isValidTransform($t1)); if (`size $r`) warning $r;
    $r = assertTrue(isValidNurbsCurve($nc1)); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0}, `getAttr ($t1 + ".st")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 90.0}, `getAttr ($t1 + ".sr")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({2.0, 1.0, 1.0}, `getAttr ($t1 + ".ss")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0, 1.0, 0.0, 0.0}, `getAttr ($nc1 + ".cp[*]")`, 0.001); if (`size $r`) warning $r;

    $r = assertFalse(isValidTransform($t2)); if (`size $r`) warning $r;
    $r = assertFalse(isValidNurbsCurve($nc2)); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0, 0.0, 1.0, 0.0}, `getAttr ($nc2 + ".cp[*]")`, 0.001); if (`size $r`) warning $r;

    addTransformAttributes($t3);
    addCurveAttribute($nc3);
    setAttr ($t3 + ".sr") -typ "double3" 45.0 45.0 45.0;
    setAttr ($t3 + ".ss") -typ "double3" 3.0 3.0 3.0;
    setAttr ($nc3 + ".sc") -typ "nurbsCurve" 1 1 0 0 3 2 0 1 2 0 0 0 0 0 1;
    $r = assertTrue(isValidTransform($t3)); if (`size $r`) warning $r;
    $r = assertTrue(isValidNurbsCurve($nc3)); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0}, `getAttr ($t3 + ".st")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({45.0, 45.0, 45.0}, `getAttr ($t3 + ".sr")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({3.0, 3.0, 3.0}, `getAttr ($t3 + ".ss")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0, 0.0, 0.0, 1.0}, `getAttr ($nc3 + ".cp[*]")`, 0.001); if (`size $r`) warning $r;

    $t2ShapeNodes = replaceCurves({$t1, $t2});
    $r = assertTrue(isValidTransform($t2)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({$t2 + "Shape1"}, $t2ShapeNodes); if (`size $r`) warning $r;
    $r = assertTrue(isValidNurbsCurve($t2ShapeNodes[0])); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0}, `getAttr ($t2 + ".st")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 90.0}, `getAttr ($t2 + ".sr")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({2.0, 1.0, 1.0}, `getAttr ($t2 + ".ss")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0, 0.0, 2.0, 0.0}, `getAttr ($t2ShapeNodes[0] + ".cp[*]")`, 0.001); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $t1`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $t1ShapeNodes[0]`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $nc2`); if (`size $r`) warning $r;

    $t3ShapeNodes = replaceCurves({$t2, $t3});
    $r = assertTrue(isValidTransform($t3)); if (`size $r`) warning $r;
    $r = assertStringArrayEqual({$t3 + "Shape1"}, $t3ShapeNodes); if (`size $r`) warning $r;
    $r = assertTrue(isValidNurbsCurve($t3ShapeNodes[0])); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0}, `getAttr ($t3 + ".st")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 90.0}, `getAttr ($t3 + ".sr")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({2.0, 1.0, 1.0}, `getAttr ($t3 + ".ss")`, 0.001); if (`size $r`) warning $r;
    $r = assertFloatArrayEqual({0.0, 0.0, 0.0, 0.0, 2.0, 0.0}, `getAttr ($t3ShapeNodes[0] + ".cp[*]")`, 0.001); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $t2`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $t2ShapeNodes[0]`); if (`size $r`) warning $r;
    $r = assertFalse(`objExists $nc3`); if (`size $r`) warning $r;

    if (`objExists $t1`) delete $t1;
    if (`objExists $t2`) delete $t2;
    if (`objExists $t3`) delete $t3;
  }

  print("test3 end\n");

  if ($existsOrderFile) {
    writeAllText($curveOrderFilename, "", $lastOrderContent);
  }
}

/*-
@param $flags <boolean[]>
@returns <>
*/
global proc nkCurveDepotTest(int $flags[]) {
  if ($flags[0]) test0();
  if ($flags[1]) test1();
  if ($flags[2]) test2();
  if ($flags[3]) test3();
}

/*
eval ("source \"" + `getenv "MAYA_APP_DIR"` + "/dev/nkCurveDepot/nkCurveDepot.mel\"");
nkCurveDepotTest({1, 1, 1, 1});
*/
